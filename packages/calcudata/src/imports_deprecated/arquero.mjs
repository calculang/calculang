/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/arquero@7.2.0/src/index-browser.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{parse as t}from"/npm/acorn@8.14.0/+esm";import{tableFromColumns as e,columnFromArray as n,columnFromValues as r,tableToIPC as a,tableFromIPC as s}from"/npm/@uwdata/flechette@1.1.1/+esm";const o=2147483648;class i{constructor(t){this._size=t,this._bits=new Uint32Array(Math.ceil(t/32))}get length(){return this._size}count(){const t=this._bits.length;let e=0;for(let n=0;n<t;++n)for(let t=this._bits[n];t;++e)t&=t-1;return e}get(t){return this._bits[t>>5]&o>>>t}set(t){this._bits[t>>5]|=o>>>t}clear(t){this._bits[t>>5]&=~(o>>>t)}scan(t){for(let e=this.next(0);e>=0;e=this.next(e+1))t(e)}next(t){const e=this._bits,n=e.length;let r=t>>5,a=e[r]&4294967295>>>t;for(;r<n;a=e[++r])if(0!==a)return(r<<5)+Math.clz32(a);return-1}nth(t){let e=this.next(0);for(;t--&&e>=0;)e=this.next(e+1);return e}not(){const t=this._bits,e=t.length;for(let n=0;n<e;++n)t[n]=~t[n];const n=this._size%32;return n&&(t[e-1]&=o>>n-1),this}and(t){if(t){const e=this._bits,n=t._bits,r=e.length;for(let t=0;t<r;++t)e[t]&=n[t]}return this}or(t){if(t){const e=this._bits,n=t._bits,r=e.length;for(let t=0;t<r;++t)e[t]|=n[t]}return this}}var u=void 0,l=Array.isArray;const c=Object.getPrototypeOf(Int8Array);function f(t){return t instanceof c}function d(t){return l(t)||f(t)}function m(t){return"string"==typeof t}function h(t){return null!=t&&t==t}const p=t=>d(t)||m(t);var g={compact:t=>d(t)?t.filter((t=>h(t))):t,concat:(...t)=>[].concat(...t),includes:(t,e,n)=>!!p(t)&&t.includes(e,n),indexof:(t,e)=>p(t)?t.indexOf(e):-1,join:(t,e)=>d(t)?t.join(e):u,lastindexof:(t,e)=>p(t)?t.lastIndexOf(e):-1,length:t=>p(t)?t.length:0,pluck:(t,e)=>d(t)?t.map((t=>h(t)?t[e]:u)):u,reverse:t=>d(t)?t.slice().reverse():m(t)?t.split("").reverse().join(""):u,slice:(t,e,n)=>p(t)?t.slice(e,n):u};function v(t,e,n="0"){const r=t+"",a=r.length;return a<e?Array(e-a+1).join(n)+r:r}const y=t=>(t<10?"0":"")+t,_=t=>t<0?"-"+v(-t,6):t>9999?"+"+v(t,6):v(t,4);function w(t,e,n,r,a,s,o,i,u){const l=i?"Z":"";return _(t)+"-"+y(e+1)+"-"+y(n)+(!u||o?"T"+y(r)+":"+y(a)+":"+y(s)+"."+v(o,3)+l:s?"T"+y(r)+":"+y(a)+":"+y(s)+l:a||r||!i?"T"+y(r)+":"+y(a)+l:"")}function x(t,e){return isNaN(t)?"Invalid Date":w(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds(),!1,e)}function b(t,e){return isNaN(t)?"Invalid Date":w(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds(),!0,e)}const $=/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/;function M(t){return t.match($)&&!isNaN(Date.parse(t))}const E=864e5,j=6048e5,k=new Date,N=new Date,O=t=>(k.setTime("string"==typeof t?function(t,e=Date.parse){return M(t)?e(t):t}(t):t),k);var S={format_date:(t,e)=>x(O(t),!e),format_utcdate:(t,e)=>b(O(t),!e),now:Date.now,timestamp:t=>+O(t),datetime:function(t,e,n,r,a,s,o){return arguments.length?new Date(t,e||0,null==n?1:n,r||0,a||0,s||0,o||0):new Date(Date.now())},year:t=>O(t).getFullYear(),quarter:t=>Math.floor(O(t).getMonth()/3),month:t=>O(t).getMonth(),week:function(t,e){const n=e||0;N.setTime(+t),N.setDate(N.getDate()-(N.getDay()+7-n)%7),N.setHours(0,0,0,0),k.setTime(+t),k.setMonth(0),k.setDate(1),k.setDate(1-(k.getDay()+7-n)%7),k.setHours(0,0,0,0);const r=6e4*(N.getTimezoneOffset()-k.getTimezoneOffset());return Math.floor((+N-+k+1-r)/j)},date:t=>O(t).getDate(),dayofyear:function(t){N.setTime(+t),N.setHours(0,0,0,0),k.setTime(+N),k.setMonth(0),k.setDate(1);const e=6e4*(N.getTimezoneOffset()-k.getTimezoneOffset());return Math.floor(1+(+N-+k-e)/E)},dayofweek:t=>O(t).getDay(),hours:t=>O(t).getHours(),minutes:t=>O(t).getMinutes(),seconds:t=>O(t).getSeconds(),milliseconds:t=>O(t).getMilliseconds(),utcdatetime:function(t,e,n,r,a,s,o){return arguments.length?new Date(Date.UTC(t,e||0,null==n?1:n,r||0,a||0,s||0,o||0)):new Date(Date.now())},utcyear:t=>O(t).getUTCFullYear(),utcquarter:t=>Math.floor(O(t).getUTCMonth()/3),utcmonth:t=>O(t).getUTCMonth(),utcweek:function(t,e){const n=e||0;return N.setTime(+t),N.setUTCDate(N.getUTCDate()-(N.getUTCDay()+7-n)%7),N.setUTCHours(0,0,0,0),k.setTime(+t),k.setUTCMonth(0),k.setUTCDate(1),k.setUTCDate(1-(k.getUTCDay()+7-n)%7),k.setUTCHours(0,0,0,0),Math.floor((+N-+k+1)/j)},utcdate:t=>O(t).getUTCDate(),utcdayofyear:function(t){N.setTime(+t),N.setUTCHours(0,0,0,0);const e=Date.UTC(N.getUTCFullYear(),0,1);return Math.floor(1+(+N-e)/E)},utcdayofweek:t=>O(t).getUTCDay(),utchours:t=>O(t).getUTCHours(),utcminutes:t=>O(t).getUTCMinutes(),utcseconds:t=>O(t).getUTCSeconds(),utcmilliseconds:t=>O(t).getUTCMilliseconds()};function A(t){return t instanceof Date}function C(t){return t instanceof RegExp}function T(t){return t===Object(t)}function U(t,e){return null!=t&&null!=e&&t==t&&e==e&&(t===e||(A(t)||A(e)?+t==+e:C(t)&&C(e)?t+""==e+"":!(!T(t)||!T(e))&&function(t,e){if(Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;if(t.length||e.length)return D(t,e);const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;if(n.sort(),r.sort(),!D(n,r,((t,e)=>t===e)))return!1;const a=n.length;for(let r=0;r<a;++r){const a=n[r];if(!U(t[a],e[a]))return!1}return!0}(t,e)))}function D(t,e,n=U){const r=t.length;if(r!==e.length)return!1;for(let a=0;a<r;++a)if(!n(t[a],e[a]))return!1;return!0}var F={parse_json:t=>JSON.parse(t),to_json:t=>JSON.stringify(t)};let R=Math.random;function z(){return R()}function I(t){R=h(t)&&isFinite(t=+t)?function(t){const e=1664525,n=1013904223,r=1/4294967296;return t=0|(0<=t&&t<1?t/r:Math.abs(t)),()=>r*((t=e*t+n|0)>>>0)}(t):Math.random}var q={random:z,is_nan:Number.isNaN,is_finite:Number.isFinite,abs:Math.abs,cbrt:Math.cbrt,ceil:Math.ceil,clz32:Math.clz32,exp:Math.exp,expm1:Math.expm1,floor:Math.floor,fround:Math.fround,greatest:Math.max,least:Math.min,log:Math.log,log10:Math.log10,log1p:Math.log1p,log2:Math.log2,pow:Math.pow,round:Math.round,sign:Math.sign,sqrt:Math.sqrt,trunc:Math.trunc,degrees:t=>180*t/Math.PI,radians:t=>Math.PI*t/180,acos:Math.acos,acosh:Math.acosh,asin:Math.asin,asinh:Math.asinh,atan:Math.atan,atan2:Math.atan2,atanh:Math.atanh,cos:Math.cos,cosh:Math.cosh,sin:Math.sin,sinh:Math.sinh,tan:Math.tan,tanh:Math.tanh},P=Object.hasOwn;function L(t){return t instanceof Map}function G(t){return L(t)||function(t){return t instanceof Set}(t)}function H(t){return Array.from(t)}var J={has:(t,e)=>G(t)?t.has(e):null!=t&&P(t,`${e}`),keys:t=>L(t)?H(t.keys()):null!=t?Object.keys(t):[],values:t=>G(t)?H(t.values()):null!=t?Object.values(t):[],entries:t=>G(t)?H(t.entries()):null!=t?Object.entries(t):[],object:t=>t?Object.fromEntries(t):u};function V(t,e,n){let r=arguments.length;t=+t,e=+e,n=r<2?(e=t,t=0,1):r<3?1:+n,r=0|Math.max(0,Math.ceil((e-t)/n));const a=new Array(r);for(let e=0;e<r;++e)a[e]=t+e*n;return a}var W={bin:function(t,e,n,r,a){return null==t?null:t<e?-1/0:t>n?1/0:(t=Math.max(e,Math.min(t,n)),e+r*Math.floor(1e-14+(t-e)/r+(a||0)))},equal:U,recode:function(t,e,n){if(e instanceof Map){if(e.has(t))return e.get(t)}else{const n=`${t}`;if(P(e,n))return e[n]}return void 0!==n?n:t},sequence:V,...g,...S,...F,...q,...J,...{parse_date:t=>null==t?t:new Date(t),parse_float:t=>null==t?t:Number.parseFloat(t),parse_int:(t,e)=>null==t?t:Number.parseInt(t,e),endswith:(t,e,n)=>null!=t&&String(t).endsWith(e,n),match:(t,e,n)=>{const r=null==t?t:String(t).match(e);return null==n||null==r?r:"number"==typeof n?r[n]:r.groups?r.groups[n]:null},normalize:(t,e)=>null==t?t:String(t).normalize(e),padend:(t,e,n)=>null==t?t:String(t).padEnd(e,n),padstart:(t,e,n)=>null==t?t:String(t).padStart(e,n),upper:t=>null==t?t:String(t).toUpperCase(),lower:t=>null==t?t:String(t).toLowerCase(),repeat:(t,e)=>null==t?t:String(t).repeat(e),replace:(t,e,n)=>null==t?t:String(t).replace(e,String(n)),split:(t,e,n)=>null==t?[]:String(t).split(e,n),startswith:(t,e,n)=>null!=t&&String(t).startsWith(e,n),substring:(t,e,n)=>null==t?t:String(t).substring(e,n),trim:t=>null==t?t:String(t).trim()}};function B(t){return null!=t?l(t)?t:[t]:[]}function Y(t){return"bigint"==typeof t}function Q(t){return void 0===t?t+"":Y(t)?t+"n":JSON.stringify(t)}class Z{constructor(t,e,n){this.name=t,this.fields=e,this.params=n}toString(){const t=[...this.fields.map((t=>`d[${Q(t)}]`)),...this.params.map(Q)];return`d => op.${this.name}(${t})`}toObject(){return{expr:this.toString(),func:!0}}}function K(t,e=[],n=[]){return new Z(t,B(e),B(n))}const X=t=>K("any",t),tt=()=>K("count"),et=t=>K("array_agg",t),nt=t=>K("array_agg_distinct",t),rt=(t,e)=>K("map_agg",[t,e]),at=(t,e)=>K("object_agg",[t,e]),st=(t,e)=>K("entries_agg",[t,e]);var ot={...W,row_object:(...t)=>K("row_object",null,t.flat()),count:tt,any:X,array_agg:et,array_agg_distinct:nt,object_agg:at,map_agg:rt,entries_agg:st,valid:t=>K("valid",t),invalid:t=>K("invalid",t),distinct:t=>K("distinct",t),mode:t=>K("mode",t),sum:t=>K("sum",t),product:t=>K("product",t),mean:t=>K("mean",t),average:t=>K("average",t),variance:t=>K("variance",t),variancep:t=>K("variancep",t),stdev:t=>K("stdev",t),stdevp:t=>K("stdevp",t),min:t=>K("min",t),max:t=>K("max",t),quantile:(t,e)=>K("quantile",t,e),median:t=>K("median",t),covariance:(t,e)=>K("covariance",[t,e]),covariancep:(t,e)=>K("covariancep",[t,e]),corr:(t,e)=>K("corr",[t,e]),bins:(t,e,n,r,a)=>K("bins",t,[e,n,r,a]),row_number:()=>K("row_number"),rank:()=>K("rank"),avg_rank:()=>K("avg_rank"),dense_rank:()=>K("dense_rank"),percent_rank:()=>K("percent_rank"),cume_dist:()=>K("cume_dist"),ntile:t=>K("ntile",null,t),lag:(t,e,n)=>K("lag",t,[e,n]),lead:(t,e,n)=>K("lead",t,[e,n]),first_value:t=>K("first_value",t),last_value:t=>K("last_value",t),nth_value:(t,e)=>K("nth_value",t,e),fill_down:(t,e)=>K("fill_down",t,e),fill_up:(t,e)=>K("fill_up",t,e)};function it(t,e){throw Error(t,{cause:e})}class ut{constructor(t){this._outputs=t}size(){return this._outputs.length}outputs(){return this._outputs}init(t){return{}}add(t,e,n){}rem(t,e,n){}write(t,e,n){}}function lt(t){const e=typeof t;return"string"===e?`"${t}"`:"object"===e&&t?A(t)?+t:l(t)||f(t)?`[${t.map(lt)}]`:C(t)?t+"":function(t){let e="{",n=-1;for(const r in t)++n>0&&(e+=","),e+=`"${r}":${lt(t[r])}`;return e+="}",e}(t):t}function ct(t,e){const n=t.length;return 1===n?(e,n)=>lt(t[0](e,n)):(r,a)=>{let s="";for(let o=0;o<n;++o){o>0&&(s+="|");const n=t[o](r,a);if(e&&(null==n||n!=n))return null;s+=lt(n)}return s}}function ft(){}function dt(t){return t.init=t.init||ft,t.add=t.add||ft,t.rem=t.rem||ft,t}function mt(t,e){return t.product_v=!1,t.product=e}var ht={count:{create:()=>dt({value:t=>t.count}),param:[]},array_agg:{create:()=>dt({init:t=>t.values=!0,value:t=>t.list.values(t.stream)}),param:[1]},object_agg:{create:()=>dt({init:t=>t.values=!0,value:t=>Object.fromEntries(t.list.values())}),param:[2]},map_agg:{create:()=>dt({init:t=>t.values=!0,value:t=>new Map(t.list.values())}),param:[2]},entries_agg:{create:()=>dt({init:t=>t.values=!0,value:t=>t.list.values(t.stream)}),param:[2]},any:{create:()=>dt({add:(t,e)=>{null==t.any&&(t.any=e)},value:t=>t.valid?t.any:u}),param:[1]},valid:{create:()=>dt({value:t=>t.valid}),param:[1]},invalid:{create:()=>dt({value:t=>t.count-t.valid}),param:[1]},distinct:{create:()=>({init:t=>t.distinct=function(){const t=new Map;return{count:()=>t.size,values:()=>Array.from(t.values(),(t=>t.v)),increment(e){const n=lt(e),r=t.get(n);r?++r.n:t.set(n,{v:e,n:1})},decrement(e){const n=lt(e),r=t.get(n);1===r.n?t.delete(n):--r.n},forEach(e){t.forEach((({v:t,n:n})=>e(t,n)))}}}(),value:t=>t.distinct.count()+(t.valid===t.count?0:1),add:(t,e)=>t.distinct.increment(e),rem:(t,e)=>t.distinct.decrement(e)}),param:[1]},array_agg_distinct:{create:()=>dt({value:t=>t.distinct.values()}),param:[1],req:["distinct"]},mode:{create:()=>dt({value:t=>{let e=u,n=0;return t.distinct.forEach(((t,r)=>{r>n&&(n=r,e=t)})),e}}),param:[1],req:["distinct"]},sum:{create:()=>({init:t=>t.sum=0,value:t=>t.valid?t.sum:u,add:(t,e)=>Y(e)?0===t.sum?t.sum=e:t.sum+=e:t.sum+=+e,rem:(t,e)=>t.sum-=e}),param:[1]},product:{create:()=>({init:t=>mt(t,1),value:t=>t.valid?t.product_v?mt(t,function(t,e=0,n=t.length){let r=t[e++];for(let a=e;a<n;++a)r*=t[a];return r}(t.list.values())):t.product:void 0,add:(t,e)=>Y(e)&&1===t.product?t.product=e:t.product*=e,rem:(t,e)=>0==e||e===1/0||e===-1/0?t.product_v=!0:t.product/=e}),param:[1],stream:["array_agg"]},mean:{create:()=>({init:t=>t.mean=0,value:t=>t.valid?t.mean:u,add:(t,e)=>{t.mean_d=e-t.mean,t.mean+=t.mean_d/t.valid},rem:(t,e)=>{t.mean_d=e-t.mean,t.mean-=t.valid?t.mean_d/t.valid:t.mean}}),param:[1]},average:{create:()=>dt({value:t=>t.valid?t.mean:u}),param:[1],req:["mean"]},variance:{create:()=>({init:t=>t.dev=0,value:t=>t.valid>1?t.dev/(t.valid-1):u,add:(t,e)=>t.dev+=t.mean_d*(e-t.mean),rem:(t,e)=>t.dev-=t.mean_d*(e-t.mean)}),param:[1],req:["mean"]},variancep:{create:()=>dt({value:t=>t.valid>1?t.dev/t.valid:u}),param:[1],req:["variance"]},stdev:{create:()=>dt({value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid-1)):u}),param:[1],req:["variance"]},stdevp:{create:()=>dt({value:t=>t.valid>1?Math.sqrt(t.dev/t.valid):u}),param:[1],req:["variance"]},min:{create:()=>({init:t=>t.min=u,value:t=>t.min=Number.isNaN(t.min)?t.list.min():t.min,add:(t,e)=>{(e<t.min||t.min===u)&&(t.min=e)},rem:(t,e)=>{e<=t.min&&(t.min=NaN)}}),param:[1],stream:["array_agg"]},max:{create:()=>({init:t=>t.max=u,value:t=>t.max=Number.isNaN(t.max)?t.list.max():t.max,add:(t,e)=>{(e>t.max||t.max===u)&&(t.max=e)},rem:(t,e)=>{e>=t.max&&(t.max=NaN)}}),param:[1],stream:["array_agg"]},quantile:{create:t=>dt({value:e=>e.list.quantile(t)}),param:[1,1],req:["array_agg"]},median:{create:()=>dt({value:t=>t.list.quantile(.5)}),param:[1],req:["array_agg"]},covariance:{create:()=>({init:t=>{t.cov=t.mean_x=t.mean_y=t.dev_x=t.dev_y=0},value:t=>t.valid>1?t.cov/(t.valid-1):u,add:(t,e,n)=>{const r=e-t.mean_x,a=n-t.mean_y;t.mean_x+=r/t.valid,t.mean_y+=a/t.valid;const s=n-t.mean_y;t.dev_x+=r*(e-t.mean_x),t.dev_y+=a*s,t.cov+=r*s},rem:(t,e,n)=>{const r=e-t.mean_x,a=n-t.mean_y;t.mean_x-=t.valid?r/t.valid:t.mean_x,t.mean_y-=t.valid?a/t.valid:t.mean_y;const s=n-t.mean_y;t.dev_x-=r*(e-t.mean_x),t.dev_y-=a*s,t.cov-=r*s}}),param:[2]},covariancep:{create:()=>dt({value:t=>t.valid>1?t.cov/t.valid:u}),param:[2],req:["covariance"]},corr:{create:()=>dt({value:t=>t.valid>1?t.cov/(Math.sqrt(t.dev_x)*Math.sqrt(t.dev_y)):u}),param:[2],req:["covariance"]},bins:{create:(t,e,n,r)=>dt({value:a=>function(t,e,n=15,r=!0,a=0,s){const o=Math.LN10;if(null==s){const r=Math.ceil(Math.log(n)/o),i=e-t||Math.abs(t)||1,u=[5,2];for(s=Math.max(a,Math.pow(10,Math.round(Math.log(i)/o)-r));Math.ceil(i/s)>n;)s*=10;const l=u.length;for(let t=0;t<l;++t){const e=s/u[t];e>=a&&i/e<=n&&(s=e)}}if(r){let n=Math.log(s);const r=n>=0?0:1+~~(-n/o),a=Math.pow(10,-r-1);n=Math.floor(t/s+a)*s,t=t<n?n-s:n,e=Math.ceil(e/s)*s}return[t,e===t?t+s:e,s]}(a.min,a.max,t,e,n,r)}),param:[1,4],req:["min","max"]}};const pt={create(){let t;return{init:()=>t=1,value:e=>{const n=e.index;return n&&!e.peer(n)?t=n+1:t}}},param:[]},gt={create(){let t;return{init:()=>t=0,value:e=>{const{index:n,peer:r,size:a}=e;let s=n;if(t<s){for(;s+1<a&&r(s+1);)++s;t=s}return(1+t)/a}}},param:[]};var vt={row_number:{create:()=>({init:ft,value:t=>t.index+1}),param:[]},rank:pt,avg_rank:{create(){let t,e;return{init:()=>(t=-1,e=1),value:n=>{const r=n.index;if(r>=t){for(e=t=r+1;n.peer(t);e+=++t);e/=t-r}return e}}},param:[]},dense_rank:{create(){let t;return{init:()=>t=1,value:e=>{const n=e.index;return n&&!e.peer(n)?++t:t}}},param:[]},percent_rank:{create(){const{init:t,value:e}=pt.create();return{init:t,value:t=>(e(t)-1)/(t.size-1)}},param:[]},cume_dist:gt,ntile:{create(t){(t=+t)>0||it("ntile num must be greater than zero.");const{init:e,value:n}=gt.create();return{init:e,value:e=>Math.ceil(t*n(e))}},param:[0,1]},lag:{create:(t,e=u)=>(t=+t||1,{init:ft,value:(n,r)=>{const a=n.index-t;return a>=0?n.value(a,r):e}}),param:[1,2]},lead:{create:(t,e=u)=>(t=+t||1,{init:ft,value:(n,r)=>{const a=n.index+t;return a<n.size?n.value(a,r):e}}),param:[1,2]},first_value:{create:()=>({init:ft,value:(t,e)=>t.value(t.i0,e)}),param:[1]},last_value:{create:()=>({init:ft,value:(t,e)=>t.value(t.i1-1,e)}),param:[1]},nth_value:{create:t=>((t=+t)>0||it("nth_value nth must be greater than zero."),{init:ft,value:(e,n)=>{const r=e.i0+(t-1);return r<e.i1?e.value(r,n):u}}),param:[1,1]},fill_down:{create(t=u){let e;return{init:()=>e=t,value:(t,n)=>{const r=t.value(t.index,n);return h(r)?e=r:e}}},param:[1,1]},fill_up:{create(t=u){let e,n;return{init:()=>(e=t,n=-1),value:(r,a)=>r.index<=n?e:(n=function(t,e,n){for(const r=t.size;n<r;++n)if(h(t.value(n,e)))return n;return-1}(r,a,r.index))>=0?e=r.value(n,a):(n=r.size,e=t)}},param:[1,1]}};function yt(t){return P(ht,t)}function _t(t){return P(vt,t)}function wt(t){return P(W,t)||"row_object"===t}function xt(t){return yt(t)&&ht[t]}function bt(t){return _t(t)&&vt[t]}function $t(t,e=((t,e)=>t),n=""){const r=t.length;if(!r)return"";let a=e(t[0],0);for(let s=1;s<r;++s)a+=n+e(t[s],s);return a}function Mt(t,e,...n){const r=["_","$"],a=r.slice(0,n.length);return a.push('"use strict"; const '+n.map(((t,e)=>t.map(((t,n)=>`${r[e]}${n} = ${r[e]}[${n}]`)).join(", "))).join(", ")+`; return (${t}) => ${e};`),Function(...a)(...n)}function Et(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function jt(t){return Y(t)?t:+t}class kt{constructor(t){this._values=t||[],this._sorted=null,this._start=0}values(t){return this._start&&(this._values=this._values.slice(this._start),this._start=0),t?this._values.slice():this._values}add(t){this._values.push(t),this._sorted=null}rem(){this._start+=1,this._sorted=null}min(){return this._sorted&&this._sorted.length?this._sorted[0]:function(t,e=0,n=t.length){let r=n?t[e++]:u;for(let a=e;a<n;++a)r>t[a]&&(r=t[a]);return r}(this._values,this._start)}max(){return this._sorted&&this._sorted.length?this._sorted[this._sorted.length-1]:function(t,e=0,n=t.length){let r=n?t[e++]:u;for(let a=e;a<n;++a)r<t[a]&&(r=t[a]);return r}(this._values,this._start)}quantile(t){return this._sorted||(this._sorted=this.values(!0),this._sorted.sort(Et)),function(t,e){const n=t.length;if(!n)return u;if((e=+e)<=0||n<2)return jt(t[0]);if(e>=1)return jt(t[n-1]);const r=(n-1)*e,a=Math.floor(r),s=jt(t[a]);return Y(s)?s:s+(jt(t[a+1])-s)*(r-a)}(this._sorted,t)}}const Nt=(t,e,n)=>Mt(e,"{"+$t(t,((t,r)=>`_${r}.${n}(${e});`))+"}",t);function Ot(t,e){const{ops:n,output:r}=function(t,e){const n={},r=[];function a(t,s=[]){const o=t+":"+s;if(n[o])return n[o];const i=xt(t),u=i.create(...s);return e<0&&i.stream&&i.stream.forEach((t=>a(t,[]))),i.req&&i.req.forEach((t=>a(t,[]))),n[o]=u,r.push(u),u}const s=t.map((t=>{const e=a(t.name,t.params);return e.output=t.id,e}));return{ops:r,output:s}}(t,e),a=t[0].fields,s=a.length;return new(0===s?St:1===s?At:2===s?Ct:it("Unsupported field count: "+s))(a,n,r,e)}class St extends ut{constructor(t,e,n,r){super(n),this._op=e,this._fields=t,this._stream=!!r}init(){const t={count:0,valid:0,stream:this._stream};return this._op.forEach((e=>e.init(t))),t.values&&(t.list=new kt),t}write(t,e,n){const r=this._outputs,a=r.length;for(let s=0;s<a;++s)e[r[s].output][n]=r[s].value(t);return 1}_add(){}_rem(){}add(t){++t.count}rem(t){--t.count}}class At extends St{constructor(t,e,n,r){super(t,e,n,r);const a=["state","v1","v2"];this._add=Nt(e,a,"add"),this._rem=Nt(e,a,"rem")}add(t,e,n){const r=this._fields[0](e,n);++t.count,h(r)&&(++t.valid,t.list&&t.list.add(r),this._add(t,r))}rem(t,e,n){const r=this._fields[0](e,n);--t.count,h(r)&&(--t.valid,t.list&&t.list.rem(),this._rem(t,r))}}class Ct extends St{constructor(t,e,n,r){super(t,e,n,r);const a=["state","v1","v2"];this._add=Nt(e,a,"add"),this._rem=Nt(e,a,"rem")}add(t,e,n){const r=this._fields[0](e,n),a=this._fields[1](e,n);++t.count,h(r)&&h(a)&&(++t.valid,t.list&&t.list.add([r,a]),this._add(t,r,a))}rem(t,e,n){const r=this._fields[0](e,n),a=this._fields[1](e,n);--t.count,h(r)&&h(a)&&(--t.valid,t.list&&t.list.rem(),this._rem(t,r,a))}}function Tt(t){return"function"==typeof t}function Ut(t,e){const n=Array(t);if(Tt(e))for(let r=0;r<t;++r)n[r]=e(r);else n.fill(e);return n}function Dt(t,e,n){if(e.length){const r=t.data(),{keys:a}=t.groups()||{},s=Ft(t,e),o=a?(t,e)=>s[t][a[e]]:t=>s[t][0];n=n.map((t=>e=>t(e,r,o)))}return n}function Ft(t,e,n){if(!e.length)return n;const r=Rt(e),a=t.groups(),s=a?a.size:1;return n=n||Ut(e.length,(()=>Array(s))),s>1?r.forEach((e=>{const r=It(t,e,a);for(let t=0;t<s;++t)e.write(r[t],n,t)})):r.forEach((e=>{const r=zt(t,e);e.write(r,n,0)})),n}function Rt(t,e){const n=[],r={};for(const e of t){const t=e.fields.map((t=>t+"")).join(",");(r[t]||(r[t]=[])).push(e)}for(const t in r)n.push(Ot(r[t],e));return n}function zt(t,e){const n=e.init(),r=t.totalRows(),a=t.data(),s=t.mask();if(t.isOrdered()){const s=t.indices();for(let t=0;t<r;++t)e.add(n,s[t],a)}else if(s)for(let t=s.next(0);t>=0;t=s.next(t+1))e.add(n,t,a);else for(let t=0;t<r;++t)e.add(n,t,a);return n}function It(t,e,n){const{keys:r,size:a}=n,s=Ut(a,(()=>e.init())),o=t.data();if(t.isOrdered()){const n=t.indices(),a=n.length;for(let t=0;t<a;++t){const a=n[t];e.add(s[r[a]],a,o)}}else if(t.isFiltered()){const n=t.mask();for(let t=n.next(0);t>=0;t=n.next(t+1))e.add(s[r[t]],t,o)}else{const n=t.totalRows();for(let t=0;t<n;++t)e.add(s[r[t]],t,o)}return s}function qt(t,e){const{get:n,names:r,rows:a,size:s}=e,o=r.length;for(let e=0;e<o;++e){const o=t.add(r[e],Array(s)),i=n[e];for(let t=0;t<s;++t)o[t]=i(a[t])}}const Pt="ArrowFunctionExpression",Lt="FunctionExpression",Gt="Identifier",Ht="Literal",Jt="MemberExpression",Vt="ObjectExpression",Wt="ObjectPattern",Bt="Property",Yt="Column",Qt="Constant",Zt="Dictionary",Kt="Parameter";function Xt(t,e,n,r){const a=n[t.type]||n.Default;if(a&&!1===a(t,e,r))return;const s=oe[t.type];s&&s(t,e,n)}const te=(t,e,n)=>{Xt(t.argument,e,n,t)},ee=(t,e,n)=>{Xt(t.left,e,n,t),Xt(t.right,e,n,t)},ne=(t,e,n)=>{Xt(t.test,e,n,t),Xt(t.consequent,e,n,t),t.alternate&&Xt(t.alternate,e,n,t)},re=(t,e,n)=>{se(t.params,e,n,t),Xt(t.body,e,n,t)},ae=(t,e,n)=>{Xt(t.callee,e,n,t),se(t.arguments,e,n,t)},se=(t,e,n,r)=>{t.forEach((t=>Xt(t,e,n,r)))},oe={TemplateLiteral:(t,e,n)=>{se(t.expressions,e,n,t),se(t.quasis,e,n,t)},MemberExpression:(t,e,n)=>{Xt(t.object,e,n,t),Xt(t.property,e,n,t)},CallExpression:ae,NewExpression:ae,ArrayExpression:(t,e,n)=>{se(t.elements,e,n,t)},AssignmentExpression:ee,AwaitExpression:te,BinaryExpression:ee,LogicalExpression:ee,UnaryExpression:te,UpdateExpression:te,ConditionalExpression:ne,ObjectExpression:(t,e,n)=>{se(t.properties,e,n,t)},Property:(t,e,n)=>{Xt(t.key,e,n,t),Xt(t.value,e,n,t)},ArrowFunctionExpression:re,FunctionExpression:re,FunctionDeclaration:re,VariableDeclaration:(t,e,n)=>{se(t.declarations,e,n,t)},VariableDeclarator:(t,e,n)=>{Xt(t.id,e,n,t),Xt(t.init,e,n,t)},SpreadElement:(t,e,n)=>{Xt(t.argument,e,n,t)},BlockStatement:(t,e,n)=>{se(t.body,e,n,t)},ExpressionStatement:(t,e,n)=>{Xt(t.expression,e,n,t)},IfStatement:ne,ForStatement:(t,e,n)=>{Xt(t.init,e,n,t),Xt(t.test,e,n,t),Xt(t.update,e,n,t),Xt(t.body,e,n,t)},WhileStatement:(t,e,n)=>{Xt(t.test,e,n,t),Xt(t.body,e,n,t)},DoWhileStatement:(t,e,n)=>{Xt(t.body,e,n,t),Xt(t.test,e,n,t)},SwitchStatement:(t,e,n)=>{Xt(t.discriminant,e,n,t),se(t.cases,e,n,t)},SwitchCase:(t,e,n)=>{t.test&&Xt(t.test,e,n,t),se(t.consequent,e,n,t)},ReturnStatement:te,Program:(t,e,n)=>{Xt(t.body[0],e,n,t)}};function ie(t){delete t.start,delete t.end,delete t.optional}function ue(t){ie(t),delete t.object,delete t.property,delete t.computed,t.table||delete t.table}function le(t,e){return e&&e.type===t}const ce=(t,e)=>{const n=ve[t.type];return n?n(t,e):it(`Unsupported expression construct: ${t.type}`)},fe=(t,e)=>"("+ce(t.left,e)+" "+t.operator+" "+ce(t.right,e)+")",de=(t,e)=>"("+he(t.params,e)+")=>"+ce(t.body,e),me=(t,e)=>ce(t.callee,e)+"("+he(t.arguments,e)+")",he=(t,e,n=",")=>t.map((t=>ce(t,e))).join(n),pe=t=>t.computed?`[${Q(t.name)}]`:`.${t.name}`,ge=(t,e,n)=>{const r=t.table||"";return`data${r}${pe(t)}.${n}(${e.index}${r})`},ve={Constant:t=>t.raw,Column:(t,e)=>t.array?((t,e)=>{const n=t.table||"";return`data${n}${pe(t)}[${e.index}${n}]`})(t,e):ge(t,e,"at"),Dictionary:(t,e)=>ge(t,e,"key"),Function:t=>`fn.${t.name}`,Parameter:t=>`$${pe(t)}`,Op:(t,e)=>`op(${Q(t.name)},${e.op||e.index})`,Literal:t=>t.raw,Identifier:t=>t.name,TemplateLiteral:(t,e)=>{const{quasis:n,expressions:r}=t,a=r.length;let s=n[0].value.raw;for(let t=0;t<a;)s+="${"+ce(r[t],e)+"}"+n[++t].value.raw;return"`"+s+"`"},MemberExpression:(t,e)=>{const n=!t.computed,r=ce(t.object,e),a=ce(t.property,e);return r+(n?"."+a:"["+a+"]")},CallExpression:me,NewExpression:(t,e)=>"new "+me(t,e),ArrayExpression:(t,e)=>"["+he(t.elements,e)+"]",AssignmentExpression:fe,BinaryExpression:fe,LogicalExpression:fe,UnaryExpression:(t,e)=>"("+t.operator+ce(t.argument,e)+")",ConditionalExpression:(t,e)=>"("+ce(t.test,e)+"?"+ce(t.consequent,e)+":"+ce(t.alternate,e)+")",ObjectExpression:(t,e)=>"({"+he(t.properties,e)+"})",Property:(t,e)=>{const n=ce(t.key,e);return(t.computed?`[${n}]`:n)+":"+ce(t.value,e)},ArrowFunctionExpression:de,FunctionExpression:de,FunctionDeclaration:de,ArrayPattern:(t,e)=>"["+he(t.elements,e)+"]",ObjectPattern:(t,e)=>"{"+he(t.properties,e)+"}",VariableDeclaration:(t,e)=>t.kind+" "+he(t.declarations,e,","),VariableDeclarator:(t,e)=>ce(t.id,e)+"="+ce(t.init,e),SpreadElement:(t,e)=>"..."+ce(t.argument,e),BlockStatement:(t,e)=>"{"+he(t.body,e,";")+";}",BreakStatement:()=>"break",ExpressionStatement:(t,e)=>ce(t.expression,e),IfStatement:(t,e)=>"if ("+ce(t.test,e)+")"+ce(t.consequent,e)+(t.alternate?" else "+ce(t.alternate,e):""),SwitchStatement:(t,e)=>"switch ("+ce(t.discriminant,e)+") {"+he(t.cases,e,"")+"}",SwitchCase:(t,e)=>(t.test?"case "+ce(t.test,e):"default")+": "+he(t.consequent,e,";")+";",ReturnStatement:(t,e)=>"return "+ce(t.argument,e),Program:(t,e)=>ce(t.body[0],e)};function ye(t,e={index:"row"}){return ce(t,e)}function _e(t,e,n){return t=`"use strict"; return ${t};`,Function("fn","$",t)(e,n)}var we={escape:(t,e,n)=>_e(t,e,n),expr:(t,e)=>_e(`(row,data,op)=>${t}`,W,e),expr2:(t,e)=>_e(`(row0,data0,row,data)=>${t}`,W,e),join:(t,e)=>_e(`(row1,data1,row2,data2)=>${t}`,W,e),param:(t,e)=>_e(t,W,e)};function xe(t){return l(t)?t:L(t)?t.entries():t?Object.entries(t):[]}const be={"==":1,"!=":1,"===":1,"!==":1};function $e(t,e,n=0,r=void 0,a=void 0){if(t.type=Yt,t.name=e,t.table=n,d(r)&&(t.array=!0),a&&r&&Tt(r.keyFor)){const e=be[a.operator]?a.left===t?a.right:a.left:a.callee&&"equal"===a.callee.name?a.arguments[a.arguments[0]===t?1:0]:null;e&&e.type===Ht&&function(t,e,n,r){r<0?(t.type=Ht,t.value=!1,t.raw="false"):(e.type=Zt,n.value=r,n.raw=r+"")}(a,t,e,r.keyFor(e.value))}return t}const Me="row_object";function Ee(t,e,n=e.columnNames()){t.type=Vt;const r=t.properties=[];for(const t of xe(n)){const[n,a]=l(t)?t:[t,t];r.push({type:Bt,key:{type:Ht,raw:Q(a)},value:$e({computed:!0},n,0,e.column(n))})}return t}function je(t,e){return ye(Ee({},t,e))}function ke(t,e){return we.expr(je(t,e))}const Ne="Escaped functions are not valid as rollup or pivot values.";function Oe(t,e,n){t.aggronly&&it(Ne);const r=`(row,data)=>fn(${je(t.table)},$)`;return{escape:we.escape(r,(a=e.expr,Tt(a)?a:()=>a),n)};var a}var Se={undefined:"void(0)",Infinity:"Number.POSITIVE_INFINITY",NaN:"Number.NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2"};function Ae(t){return"number"==typeof t}const Ce={ecmaVersion:11},Te="$",Ue="d",De="d1",Fe="d2",Re=t=>(e,n)=>n.error(e,t+" not allowed"),ze=Re("Aggregate function"),Ie=Re("Window function"),qe="Invalid argument",Pe="Invalid column reference",Le=Pe+" (must be input to an aggregate function)",Ge="Invalid function call",He="Invalid operator parameter",Je="Unsupported destructuring pattern",Ve="Table expressions do not support closures",We="Use aq.escape(fn) to use a function as-is (including closures)",Be=`\nNote: ${Ve}. ${We}, or use table.params({ name: value }) to define dynamic parameters.`,Ye=`\nNote: ${Ve}. ${We}, or use aq.addFunction(name, fn) to add new op functions.`,Qe=`The ${Me} method is not valid in multi-table expressions.`;function Ze(e,n){const r=function(e){try{const n=e.field?function(t){const e=JSON.stringify(t+"");return t.table?`(a,b)=>b[${e}]`:`d=>d[${e}]`}(e):l(e)?Q(e):e;return t(`expr=(${n})`,Ce).body[0].expression.right}catch(t){it("Expression parse error: "+(e+""))}}(n);let a=e.root=r;return e.spec=n,e.tuple=null,e.tuple1=null,e.tuple2=null,e.$param=null,e.$op=0,e.scope=new Set,e.paramsRef=new Map,e.columnRef=new Map,!function(t){return le(Lt,t)||le(Pt,t)}(a)?e.join?(e.scope.add(e.tuple1=De),e.scope.add(e.tuple2=Fe),e.scope.add(e.$param=Te)):(e.scope.add(e.tuple=Ue),e.scope.add(e.$param=Te)):(!function(t,e){t.generator&&Re("Generator functions")(t,e);t.async&&Re("Async functions")(t,e);const{params:n}=t,r=n.length,a=t=>(n,r)=>e.columnRef.set(n,[r,t]),s=(t,n)=>e.paramsRef.set(t,n);r&&(e.join?(en(e,n[0],"tuple1",a(1)),r>1&&en(e,n[1],"tuple2",a(2)),r>2&&en(e,n[2],"$param",s)):(en(e,n[0],"tuple",a(0)),r>1&&en(e,n[1],"$param",s)));e.root=t.body}(a,e),a=a.body),Xt(a,e,Ke),e.root}const Ke={FunctionDeclaration:Re("Function definitions"),ForStatement:Re("For loops"),ForOfStatement:Re("For-of loops"),ForInStatement:Re("For-in loops"),WhileStatement:Re("While loops"),DoWhileStatement:Re("Do-while loops"),AwaitExpression:Re("Await expressions"),ArrowFunctionExpression:Re("Function definitions"),AssignmentExpression:Re("Assignments"),FunctionExpression:Re("Function definitions"),NewExpression:Re('Use of "new"'),UpdateExpression:Re("Update expressions"),VariableDeclarator(t,e){dn(t.id,e)},Identifier(t,e,n){an(t,e,n)&&!e.scope.has(t.name)&&e.error(t,"Invalid variable reference",Be)},CallExpression(t,e){const n=nn(t.callee),r=xt(n)||bt(n);if(r){if((e.join||!1===e.aggregate)&&yt(n)&&ze(t,e),(e.join||!1===e.window)&&_t(n)&&Ie(t,e),e.$op=1,e.ast)fn(t,n,e),t.arguments.forEach((t=>Xt(t,e,tn)));else{const a=e.op(function(t,e,n,r){const a=[],s=[],o=e.param[0]||0,i=o+(e.param[1]||0);return r.forEach(((e,n)=>{n<o?(Xt(e,t,tn),a.push(t.field(e))):n<i?(Xt(e,t,tn),s.push(t.param(e))):t.error(e,He)})),{name:n,fields:a,params:s,...t.spec.window||{}}}(e,r,n,t.arguments));Object.assign(t,{type:"Op",name:a.id})}return e.$op=0,!1}wt(n)?fn(t,n,e):e.error(t,Ge,Ye)},MemberExpression(t,e,n){const{object:r,property:a}=t;if(!le(Gt,r))return;const{name:s}=r;if(rn(t)&&le(Gt,a)&&P(Se,a.name))return void cn(t,a.name);const o=s===e.tuple?0:s===e.tuple1?1:s===e.tuple2?2:-1;return o>=0?Xe(t,o,e,sn,n):s===e.$param?Xe(t,o,e,un):void(e.paramsRef.has(s)?ln(t,e.paramsRef.get(s)):e.columnRef.has(s)?on(r,s,e,t):P(e.params,s)&&ln(r,s))}};function Xe(t,e,n,r,a){const{property:s,computed:o}=t;let i;if(o)if(le(Ht,s))i=s.value;else try{Xt(s,n,Ke,t),i=n.param(s)}catch(e){n.error(t,"Invalid member expression")}else i=s.name;return r(t,i,e,n,a),!1}const tn={...Ke,VariableDeclarator:Re("Variable declaration in operator call"),Identifier(t,e,n){an(t,e,n)&&e.error(t,"Variable not accessible in operator call")},CallExpression(t,e){const n=nn(t.callee);wt(n)?fn(t,n,e):e.error(t,Ge,Ye)}};function en(t,e,n,r){le(Gt,e)?(t.scope.add(e.name),t[n]=e.name):le(Wt,e)&&e.properties.forEach((e=>{const n=le(Gt,e.key)?e.key.name:le(Ht,e.key)?e.key.value:t.error(e,qe);le(Gt,e.value)||t.error(e.value,Je),r(e.value.name,n)}))}function nn(t){return le(Gt,t)?t.name:le(Jt,t)?rn(t)?function(t){return"max"===t?"greatest":"min"===t?"least":t}(t.property.name):t.property.name:null}function rn(t){return le(Gt,t.object)&&"Math"===t.object.name}function an(t,e,n){const{name:r}=t;if(le(Jt,n)&&n.property===t);else if(le(Bt,n)&&n.key===t);else if(e.paramsRef.has(r))ln(t,e.paramsRef.get(r));else if(e.columnRef.has(r))on(t,r,e,n);else if(P(e.params,r))ln(t,r);else{if(!P(Se,r))return!0;cn(t,r)}}function sn(t,e,n,r,a){const s=0===n?r.table:n>0?r.join[n-1]:null,o=s&&s.column(e);s&&!o&&r.error(t,Pe),r.aggronly&&!r.$op&&r.error(t,Le),$e(t,e,n,o,a)}function on(t,e,n,r){const[a,s]=n.columnRef.get(e);sn(t,a,s,n,r)}function un(t,e,n,r){r.params&&!P(r.params,e)&&r.error(t,"Invalid param reference"),ln(t,e)}function ln(t,e){t.type=Kt,t.name=e}function cn(t,e){t.type=Qt,t.name=e,t.raw=Se[e]}function fn(t,e,n){if(e===Me){const e=n.table;e||n.error(t,Qe),Ee(t,e,t.arguments.length?t.arguments.map((t=>{const r=n.param(t),a=Ae(r)?e.columnName(r):r;return e.column(a)||n.error(t,Pe),a})):e.columnNames())}else t.callee={type:"Function",name:e}}function dn(t,e){le(Gt,t)?e.scope.add(t.name):le("ArrayPattern",t)?t.elements.forEach((t=>dn(t,e))):le(Wt,t)?t.properties.forEach((t=>dn(t.value,e))):e.error(t.id,"Unsupported variable declaration")}const mn={[Yt]:1,Op:1};function hn(t,e={}){const n=e.generate||ye,r=e.compiler||we,a=function(t){return(t.table?pn(t.table):t.join?{...pn(t.join[1]),...pn(t.join[0])}:{})||{}}(e),s={},o={},i=[],u=[];let l=0,c=-1;const f=e.join?r.join:1==e.index?r.expr2:r.expr,d={op(t){const e=function(t){let e=`${t.name}(${t.fields.concat(t.params).join(",")})`;if(t.frame){e+=`[${t.frame.map((t=>Number.isFinite(t)?Math.abs(t):-1))},${!!t.peers}]`}return e}(t);return o[e]||(t.id=++c,o[e]=t)},field(t){const e=n(t);return s[e]||(s[e]=++l)},param:t=>le(Ht,t)?t.value:r.param(n(t),a),value(t,r){i.push(t);const s=r.escape||(e.ast?(Xt(o=r,null,{Column:ue,Constant:ue,Default:ie}),o):f(n(r),a));var o;u.push(s),mn[r.type]&&s!==r&&T(s)&&(s.field=r.name)},error(t,e,n=""){const r=t.start-6,a=t.end-6;it(`${e}: "${String(d.spec).slice(r,a)}"${n}`)}};Object.assign(d,e,{params:a});for(const[e,n]of xe(t))d.value(e+"",n.escape?Oe(d,n,a):Ze(d,n));if(e.ast)return{names:i,exprs:u};const m=[];for(const t in s)m[s[t]]=r.expr(t,a);const h=Object.values(o);return h.forEach((t=>t.fields=t.fields.map((t=>m[t])))),{names:i,exprs:u,ops:h}}function pn(t){return t&&Tt(t.params)?t.params():{}}function gn(t,e){return t&&t.expr?new vn({...t,...e}):new vn(e,t)}class vn{constructor(t,e){this.expr=e,Object.assign(this,t)}toString(){return String(this.expr)}toObject(){return{...this,expr:this.toString(),...Tt(this.expr)?{func:!0}:{}}}}function yn(t,e,n=0){const r=n?{field:!0,table:n}:{field:!0};return gn(t,e?{expr:e,...r}:r)}function _n(t,e){for(const[n,r]of xe(e))t.set(n,r);return t}function wn(t){return t.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}function xn(t,e,n=new Map){return m(e=Ae(e)?t.columnName(e):e)?n.set(e,e):l(e)?e.forEach((e=>xn(t,e,n))):Tt(e)?xn(t,e(t),n):T(e)?_n(n,e):it(`Invalid column selection: ${Q(e)}`),n}function bn(t,e){return t.toObject=e,t}function $n(t){return l(t)?t.map($n):t&&t.toObject?t.toObject():t}function Mn(){return bn((t=>t.columnNames()),(()=>({all:[]})))}function En(...t){return t=t.flat(),bn((e=>{const n=xn(e,t);return e.columnNames((t=>!n.has(t)))}),(()=>({not:$n(t)})))}function jn(t,e){return bn((n=>{let r=Ae(t)?t:n.columnIndex(t),a=Ae(e)?e:n.columnIndex(e);if(a<r){const t=a;a=r,r=t}return n.columnNames().slice(r,a+1)}),(()=>({range:[t,e]})))}function kn(t){return m(t)&&(t=RegExp(wn(t))),bn((e=>e.columnNames((e=>t.test(e)))),(()=>({matches:[t.source,t.flags]})))}function Nn(t){return kn(RegExp("^"+wn(t)))}function On(t){return kn(RegExp(wn(t)+"$"))}function Sn(t,e,n,r={window:!1}){const a=new Map,s=n=>{m(n=Ae(n)?e.columnName(n):n)?a.set(n,yn(n)):Tt(n)?xn(e,n).forEach(s):T(n)?_n(a,n):it(`Invalid ${t} value: ${n+""}`)};return B(n).forEach(s),r.preparse&&r.preparse(a),hn(a,{table:e,...r})}function An(t,...e){return function(t,e){return t.create({groups:Cn(t,e)})}(t,Sn("groupby",t,e.flat()))}function Cn(t,{names:e=[],exprs:n=[],ops:r=[]}){const a=e.length;if(0===a)return null;if(1===a&&!t.isFiltered()&&n[0].field){const r=t.column(n[0].field);if(r.groups)return r.groups(e)}let s=Dt(t,r,n);const o=ct(s),i=t.totalRows(),u=new Uint32Array(i),l={},c=[],f=t.data(),d=t.mask();if(d)for(let t=d.next(0);t>=0;t=d.next(t+1)){const e=o(t,f)+"";u[t]=l[e]??=c.push(t)-1}else for(let t=0;t<i;++t){const e=o(t,f)+"";u[t]=l[e]??=c.push(t)-1}return r.length||(s=s.map((t=>e=>t(e,f)))),{keys:u,get:s,names:e,rows:c,size:c.length}}function Tn(t){return t?new Un({...t.data()},t.columnNames()):new Un}class Un{constructor(t,e){this.data=t||{},this.names=e||[]}add(t,e){return this.has(t)||this.names.push(t+""),this.data[t]=e}has(t){return P(this.data,t)}groupby(t){return this.groups=t,this}new(t){const{data:e,names:n,groups:r=null}=this;return t.create({data:e,names:n,groups:r,filter:null,order:null})}derive(t){return t.create(this)}}function Dn(t,e){return Fn(t,hn(e,{table:t,aggronly:!0,window:!1}))}function Fn(t,{names:e,exprs:n,ops:r=[]}){const a=Tn(),s=t.groups();return s&&qt(a,s),function(t,e,n,r=[],a){if(!e.length)return;const s=n?n.size:1,o=(t,e)=>r[t][e],i=t.length;for(let n=0;n<i;++n){const i=e[n];if(null!=i.field)a.add(t[n],r[i.field]);else if(s>1){const e=a.add(t[n],Array(s));for(let t=0;t<s;++t)e[t]=i(t,null,o)}else a.add(t[n],[i(0,null,o)])}}(e,n,s,Ft(t,r),a),a.new(t)}function Rn(t,...e){return zn(t,xn(t,e.flat()))}function zn(t,e){const n=Tn();return e.forEach(((e,r)=>{const a=m(e)?e:r;if(a){const e=t.column(r)||it(`Unrecognized column: ${r}`);n.add(a,e)}})),n.derive(t)}function In(t,e,n,r){const a="map"===r||!0===r?rt:"entries"===r?st:"object"===r?at:it('groups option must be "map", "entries", or "object".'),{names:s}=t.groups(),o=function(t,e){t=G(t)?t:new Set(t);let n=e,r=0;for(;t.has(n);)n=e+ ++r;return n}(t.columnNames(),"_");let i=Rn(t,{}).reify(e).create({data:{[o]:n}});i=Dn(i,{[o]:et(o)});for(let t=s.length;--t>=0;)i=Dn(An(i,s.slice(0,t)),{[o]:a(s[t],o)});return i.get(o)}class qn{constructor(t,e,n,r,a,s){const o=Object.freeze({...t}),i=(e=e?.slice()??Object.keys(o)).length?o[e[0]].length:0;this._names=Object.freeze(e),this._data=o,this._total=i,this._nrows=n?.count()??i,this._mask=n??null,this._group=r??null,this._order=a??null,this._params=s,this._index=null,this._partitions=null}create({data:t,names:e,filter:n,groups:r,order:a}={}){const s=void 0!==n?n:this.mask();return new this.constructor(t||this._data,e||(t?null:this._names),s,void 0!==r?r:function(t,e){if(!t||!e)return t;const{keys:n,rows:r,size:a}=t,s=new Uint32Array(a);e.scan((t=>s[n[t]]=1));const o=s.reduce(((t,e)=>t+e),0);if(o===a)return t;const i=Array(o);let u=0;for(let t=0;t<a;++t)s[t]&&(i[s[t]=u++]=r[t]);const l=new Uint32Array(n.length);return e.scan((t=>l[t]=s[n[t]])),{...t,keys:l,rows:i,size:u}}(this._group,n&&s),void 0!==a?a:this._order,this._params)}params(t){return arguments.length?(t&&(this._params={...this._params,...t}),this):this._params}get[Symbol.toStringTag](){if(!this._names)return"Object";const t=this.numRows(),e=this.numCols(),n=t=>1!==t?"s":"";return`Table: ${e} col${n(e)} x ${t} row${n(t)}`+(this.isFiltered()?` (${this.totalRows()} backing)`:"")+(this.isGrouped()?`, ${this._group.size} groups`:"")+(this.isOrdered()?", ordered":"")}isFiltered(){return!!this._mask}isGrouped(){return!!this._group}isOrdered(){return!!this._order}data(){return this._data}mask(){return this._mask}groups(){return this._group}comparator(){return this._order}totalRows(){return this._total}numRows(){return this._nrows}get size(){return this._nrows}numCols(){return this._names.length}columnNames(t){return t?this._names.filter(t):this._names.slice()}columnName(t){return this._names[t]}columnIndex(t){return this._names.indexOf(t)}column(t){return this._data[t]}columnAt(t){return this._data[this._names[t]]}array(t,e=Array){const n=this.column(t),r=new e(this.numRows());let a=-1;return this.scan((t=>r[++a]=n.at(t)),!0),r}get(t,e=0){const n=this.column(t);return this.isFiltered()||this.isOrdered()?n.at(this.indices()[e]):n.at(e)}getter(t){const e=this.column(t),n=this.isFiltered()||this.isOrdered()?this.indices():null;return n?t=>e.at(n[t]):e?t=>e.at(t):void it(`Unrecognized column: ${t}`)}object(t=0){return Pn(this)(t)}objects(t={}){const{grouped:e,limit:n,offset:r}=t,a=ke(this,xn(this,t.columns||Mn())),s=[];if(this.scan(((t,e)=>s.push(a(t,e))),!0,n,r),e&&this.isGrouped()){const t=[];return this.scan((e=>t.push(e)),!0,n,r),In(this,t,s,e)}return s}*[Symbol.iterator](){const t=Pn(this),e=this.numRows();for(let n=0;n<e;++n)yield t(n)}*values(t){const e=this.getter(t),n=this.numRows();for(let t=0;t<n;++t)yield e(t)}print(t={}){const e=Ae(t)?{limit:+t}:{...t,limit:10},n=this.objects({...e,grouped:!1}),r=`${this[Symbol.toStringTag]}. Showing ${n.length} rows.`;return console.log(r),console.table(n),this}indices(t=!0){if(this._index)return this._index;const e=this.numRows(),n=new Uint32Array(e),r=this.isOrdered(),a=this.mask();let s=-1;if(a)for(let t=a.next(0);t>=0;t=a.next(t+1))n[++s]=t;else for(let t=0;t<e;++t)n[++s]=t;if(t&&r){const{_order:t,_data:e}=this;n.sort(((n,r)=>t(n,r,e)))}return!t&&r||(this._index=n),n}partitions(t=!0){if(this._partitions)return this._partitions;if(!this.isGrouped())return[this.indices(t)];const{keys:e,size:n}=this._group,r=Ut(n,(()=>[])),a=this._index,s=this.mask(),o=this.numRows();if(a&&this.isOrdered())for(let t,n=0;n<o;++n)t=a[n],r[e[t]].push(t);else if(s)for(let t=s.next(0);t>=0;t=s.next(t+1))r[e[t]].push(t);else for(let t=0;t<o;++t)r[e[t]].push(t);if(t&&!a&&this.isOrdered()){const t=this._order,e=this._data;for(let a=0;a<n;++a)r[a].sort(((n,r)=>t(n,r,e)))}return!t&&this.isOrdered()||(this._partitions=r),r}reify(t){const e=t?t.length:this.numRows(),n=this._names;let r,a;if(!t&&!this.isOrdered()){if(!this.isFiltered())return this;e===this.totalRows()&&(r=this.data())}if(!r){const o=t?e=>t.forEach(e):t=>this.scan(t,!0),i=n.length;r={};for(let t=0;t<i;++t){const a=n[t],i=this.column(a),u=r[a]=new(f(s=i)?s.constructor:Array)(e);let l=-1;d(i)?o((t=>u[++l]=i[t])):o((t=>u[++l]=i.at(t)))}this.isGrouped()&&(a=function(t,e,n,r){const{keys:a,rows:s,size:o}=t;let i=s,u=o,l=null;if(n){l=new Int32Array(o),e((t=>l[a[t]]=1));const t=l.reduce(((t,e)=>t+e),0);if(t!==o){i=Array(t),u=0;for(let t=0;t<o;++t)l[t]&&(i[l[t]=u++]=s[t])}}let c=-1;const f=new Uint32Array(r);return e(u!==o?t=>f[++c]=l[a[t]]:t=>f[++c]=a[t]),{...t,keys:f,rows:i,size:u}}(this.groups(),o,!!t,e))}var s;return this.create({data:r,names:n,groups:a,filter:null,order:null})}scan(t,e,n=1/0,r=0){const a=this._mask,s=this._nrows,o=this._data;let i=r||0;if(i>s)return;const u=Math.min(s,i+n),l=()=>i=this._total;if(e&&this.isOrdered()||a&&this._index){const e=this.indices(),n=this._data;for(;i<u;++i)t(e[i],n,l)}else if(a){let e=u-i+1;for(i=a.nth(i);--e&&i>-1;i=a.next(i+1))t(i,o,l)}else for(;i<u;++i)t(i,o,l)}}function Pn(t){let e=t._builder;if(!e){const n=ke(t),r=t.data();if(t.isOrdered()||t.isFiltered()){const a=t.indices();e=t=>n(a[t],r)}else e=t=>n(t,r);t._builder=e}return e}function Ln(t,...e){e=e.flat();const n=t.numRows(),r=n+e.reduce(((t,e)=>t+e.numRows()),0);if(n===r)return t;const a=[t,...e],s=Tn();return t.columnNames().forEach((t=>{const e=Array(r);let n=0;a.forEach((r=>{const a=r.column(t)||{at:()=>u};r.scan((t=>e[n++]=a.at(t)))})),s.add(t,e)})),s.new(t)}function Gn(t,e,{before:n,after:r}={}){const a=null!=n,s=null!=r;a||s||it("relocate requires a before or after option."),a&&s&&it("relocate accepts only one of the before or after options."),e=xn(t,e);const o=[...xn(t,a?n:r).keys()],i=a?o[0]:o.pop(),u=new Map;return t.columnNames().forEach((t=>{const n=!e.has(t);if(t===i){s&&n&&u.set(t,t);for(const[t,n]of e)u.set(t,n);if(s)return}n&&u.set(t,t)})),zn(t,u)}function Hn(t){return{left(e,n,r,a){for(null==r&&(r=0),null==a&&(a=e.length);r<a;){const s=r+a>>>1;t(e[s],n)<0?r=s+1:a=s}return r},right(e,n,r,a){for(null==r&&(r=0),null==a&&(a=e.length);r<a;){const s=r+a>>>1;t(e[s],n)>0?a=s:r=s+1}return r}}}const Jn=Hn(Et);const Vn=t=>(t.frame||[null,null]).map((t=>Number.isFinite(t)?Math.abs(t):null)),Wn=t=>!!t.peers;function Bn(t,e,n,r={},a){const s=t.data(),o=function(t,e){const n={};return t.forEach((t=>{const e=Vn(t),r=Wn(t),a=`${e},${r}`,{aggOps:s,winOps:o}=n[a]||(n[a]={frame:e,peers:r,aggOps:[],winOps:[]});yt(t.name)?s.push(t):o.push(function(t){const{id:e,name:n,fields:r=[],params:a=[]}=t;return{...bt(n).create(...a),get:r.length?r[0]:null,id:e}}(t))})),Object.values(n).map((t=>function(t,e,n,r,a){let s,o,i,u,l;const c=t=>o[t-1]===o[t],f=r.length,d=a.length,m=r.length?Mt(["w","r","k"],"{"+$t(r,((t,e)=>`r[_${e}.id][k]=_${e}.value(w,_${e}.get);`))+"}",r):()=>{},h={i0:0,i1:0,index:0,size:0,peer:c,init(t,e,n,c){h.index=h.i0=h.i1=0,h.size=e.length,s=t,o=e,u=n,l=c,i=a?a.map((t=>t.init())):null;for(let t=0;t<f;++t)r[t].init();return h},value:(e,n)=>n(s[e],t),step(r){const[f,p]=e,g=h.size,v=h.i0,y=h.i1;h.i0=null!=f?Math.max(0,r-Math.abs(f)):0,h.i1=null!=p?Math.min(g,r+Math.abs(p)+1):g,h.index=r,n&&(h.i0>0&&c(h.i0)&&(h.i0=Jn.left(o,o[h.i0])),h.i1<g&&c(h.i1)&&(h.i1=Jn.right(o,o[h.i1-1])));for(let e=0;e<d;++e){const n=a[e],r=i[e];for(let e=v;e<h.i0;++e)n.rem(r,s[e],t);for(let e=y;e<h.i1;++e)n.add(r,s[e],t);n.write(r,u,l)}return m(h,u,l),u}};return h}(e,t.frame,t.peers,t.winOps,Rt(t.aggOps,null!=t.frame[0]?-1:1))))}(a,s),i=o.length,u=Mt(["r","d","op"],"{"+$t(e,((t,e)=>`_${e}[r] = $${e}(r, d, op);`))+"}",e,n);t.partitions().forEach(((e,n)=>{const a=e.length,l=function(t,e){if(t.isOrdered()){const n=t.comparator(),r=t.data(),a=e.length,s=new Uint32Array(a);for(let t=1,o=0;t<a;++t)s[t]=n(e[t-1],e[t],r)?++o:o;return s}return e}(t,e);for(let t=0;t<i;++t)o[t].init(e,l,r,n);const c=t=>r[t][n];for(let t=0;t<a;++t){for(let e=0;e<i;++e)o[e].step(t);u(e[t],s,c)}}))}function Yn(t){return _t(t.name)||t.frame&&(Number.isFinite(t.frame[0])||Number.isFinite(t.frame[1]))}function Qn(t,{names:e,exprs:n,ops:r=[]},a={}){const s=t.totalRows(),o=Tn(a.drop?null:t),i=e.map((t=>o.add(t,Array(s)))),[u,l]=function(t){const e=[],n=[],r=t.length;for(let a=0;a<r;++a){const r=t[a];r.id=a,(Yn(r)?n:e).push(r)}return[e,n]}(r),c=t.isGrouped()?t.groups().size:1,f=Ft(t,u,Ut(r.length,(()=>Array(c))));return l.length?Bn(t,i,n,f,l):function(t,e,n,r){const a=t.mask(),s=t.data(),{keys:o}=t.groups()||{},i=o?(t,e)=>r[t][o[e]]:t=>r[t][0],u=e.length;for(let r=0;r<u;++r){const o=n[r],u=e[r];if(a)for(let t=a.next(0);t>=0;t=a.next(t+1))u[t]=o(t,s,i);else{const e=t.totalRows();for(let t=0;t<e;++t)u[t]=o(t,s,i)}}}(t,i,n,f),o.derive(t)}function Zn(t,e){const n=hn({p:e},{table:t});let r=n.exprs[0];if(n.ops.length){const e=Qn(t,n,{drop:!0}).column("p");r=t=>e.at(t)}return function(t,e){const n=t.totalRows(),r=t.mask(),a=t.data(),s=new i(n);if(r)for(let t=r.next(0);t>=0;t=r.next(t+1))e(t,a)&&s.set(t);else for(let t=0;t<n;++t)e(t,a)&&s.set(t);return t.create({filter:s})}(t,r)}function Kn(t,...e){return Zn(An(t,(e=e.flat()).length?e:t.columnNames()),"row_number() === 1").ungroup().reify()}function Xn(t,e){const n=new Map;return t.scan(((t,r)=>{const a=e(t,r);null!=a&&a==a&&n.set(a,t)})),n}function tr(t,e,n){const r=new Map;B(n).forEach(((n,a)=>{m(n=Ae(n)?e.columnName(n):n)?r.set(a,yn(n)):Tt(n)||T(n)&&n.expr?r.set(a,n):it(`Invalid ${t} key value: ${n+""}`)}));return ct(hn(r,{table:e,aggregate:!1,window:!1}).exprs,!0)}function er(t,e,n){if(n)m(n)?n=[n,n]:l(n)&&1===n.length&&(n=[n[0],n[0]]);else{const r=function(t,e){const n=new Set(e);return t.filter((t=>n.has(t)))}(t.columnNames(),e.columnNames());r.length||it("Natural join requires shared column names."),n=[r,r]}return n}function nr(t,e,n,r){return n.length!==r.length&&it("Mismatched number of join keys"),[tr("join",t,n),tr("join",e,r)]}function rr(t,e,n){return sr(t,e,n,{anti:!1})}function ar(t,e,n){return sr(t,e,n,{anti:!0})}function sr(t,e,n,r){n=er(t,e,n);return function(t,e,n,r={}){const a=new i(t.totalRows()),s=l(n)?or:ir;s(a,t,e,n),r.anti&&a.not().and(t.mask());return t.create({filter:a})}(t,e,l(n)?nr(t,e,...n.map(B)):hn({on:n},{join:[t,e]}).exprs[0],r)}function or(t,e,n,[r,a]){const s=Xn(n,a);e.scan(((e,n)=>{s.get(r(e,n))>=0&&t.set(e)}))}function ir(t,e,n,r){const a=e.numRows(),s=n.numRows(),o=e.data(),i=n.data();if(e.isFiltered()||n.isFiltered()){const u=e.indices(!1),l=n.indices(!1);for(let e=0;e<a;++e){const n=u[e];for(let e=0;e<s;++e)if(r(n,o,l[e],i)){t.set(n);break}}}else for(let e=0;e<a;++e)for(let n=0;n<s;++n)if(r(e,o,n,i)){t.set(e);break}}function ur(t,{names:e=[],exprs:n=[],ops:r=[]},a={}){if(!e.length)return t;const s=a.limit>0?+a.limit:1/0,o=a.index?!0===a.index?"index":a.index+"":null,i=new Set(a.drop),u=Dt(t,r,n),l=Tn(),c=new Set(e),f=[],d=[],m=[];t.columnNames().forEach((e=>{if(!i.has(e)){const n=l.add(e,[]);c.has(e)||(f.push(t.column(e)),d.push(n))}})),e.forEach((t=>{i.has(t)||(l.has(t)||l.add(t,[]),m.push(l.data[t]))}));const h=o?l.add(o,[]):null;let p=0;const g=f.length,v=m.length,y=(t,e)=>{for(let n=0;n<g;++n)d[n].length=p+e,d[n].fill(f[n].at(t),p,p+e)},_=h?(t,e)=>{for(let n=0;n<e;++n)h[t+n]=n}:()=>{};if(1===v){const e=u[0],n=m[0];t.scan(((t,r)=>{const a=B(e(t,r)),o=Math.min(a.length,s);y(t,o);for(let t=0;t<o;++t)n[p+t]=a[t];_(p,o),p+=o}))}else t.scan(((t,e)=>{let n=0;const r=u.map((r=>{const a=B(r(t,e));return n=Math.min(Math.max(n,a.length),s),a}));y(t,n);for(let t=0;t<v;++t){const e=m[t],a=r[t];for(let t=0;t<n;++t)e[p+t]=a[t]}_(p,n),p+=n}));return l.new(t)}function lr(t,e,n){return function(t,{names:e=[],exprs:n=[],ops:r=[]},a={}){if(0===e.length)return t;const[s="key",o="value"]=a.as||[],i=Dt(t,r,n);return ur(t,{names:[s,o],exprs:[()=>e,(t,e)=>i.map((n=>n(t,e)))]},{...a,drop:e})}(t,Sn("fold",t,e),n)}function cr(t){return t.isGrouped()?t.create({groups:null}):t}function fr(t){t.forEach(((e,n)=>e.field?t.set(n,nt(e+"")):0))}function dr(t,e,n,r){const a=n&&n.length;t=a?function(t,e,n){const r=t.groups(),a=t.data(),s=(r?r.names:[]).concat(e),o=(r?r.get:[]).concat(e.map((e=>t.getter(e)))),i=new Set,u=ct(o);t.scan(((t,e)=>i.add(u(t,e))));const l=t.columnNames(),c=Tn(),f=l.map((t=>c.add(t,[])));l.forEach(((e,n)=>{const r=a[e],s=f[n];t.scan((t=>s.push(r.at(t))))}));const d=ct(o.map(((t,e)=>t=>t[e]))),m=Mt("v","{"+f.map(((t,e)=>`_${e}.push(v[$${e}]);`)).join("")+"}",f,l.map((t=>s.indexOf(t))));if(r){let t=r.keys.length;const e=n.reduce(((t,e)=>t*e.length),r.size),a=new Uint32Array(e+(t-i.size));a.set(r.keys),mr(r,n,((e,n)=>{i.has(d(e))||(m(e),a[t++]=n[0])})),c.groupby({...r,keys:a})}else mr(r,n,(t=>{i.has(d(t))||m(t)}));return c.new(t)}(t,n,r):t;const{names:s,exprs:o,ops:i}=e,u=Dt(t,i,o),l=a?null:Tn(t),c=t.totalRows();return s.forEach(((e,n)=>{const r=t.column(e),s=a?r:l.add(e,Array(c)),o=u[n];t.scan((t=>{const e=r.at(t);s[t]=h(e)?e:o(t)}))})),a?t:t.create(l)}function mr(t,e,n){const r=t?t.get.length:0,a=t?1:0,s=a+e.length,o=new Int32Array(s),i=new Int32Array(s),u=[];if(t){const{get:e,rows:n,size:a}=t;o[0]=a,u.push(((t,a)=>{const s=n[a];for(let n=0;n<r;++n)t[n]=e[n](s)}))}e.forEach(((t,e)=>{const n=e+r;o[e+a]=t.length,u.push(((e,r)=>e[n]=t[r]))}));const l=Array(r+e.length);for(let t=0;t<s;++t)u[t](l,0);n(l,i);for(let t=s-1;t>=0;){const e=++i[t];e<o[t]?(u[t](l,e),n(l,i),t=s-1):(i[t]=0,u[t](l,0),--t)}}const hr={aggregate:!1,window:!1,index:1},pr=-1/0;function gr(t,e,n,r,a={}){n=er(t,e,n);const s={join:[t,e]};let o;if(l(n)){const[s,i]=n.map(B);o=nr(t,e,s,i),r||(r=function(t,e,n,r){const a=[];e.forEach(((t,e)=>m(t)&&t===n[e]?a.push(t):0));const s=En(a);if(r.left&&r.right){const e=new Set(a);return[t.columnNames().map((t=>{const n=`[${Q(t)}]`;return e.has(t)?{[t]:`(a, b) => a${n} == null ? b${n} : a${n}`}:t})),s]}return r.right?[s,Mn()]:[Mn(),s]}(t,s,i,a))}else o=hn({on:n},s).exprs[0],r||(r=[Mn(),Mn()]);return function(t,e,n,{names:r,exprs:a},s={}){const o=t.data(),i=t.indices(!1),u=i.length,c=new Int32Array(u),f=e.data(),d=e.indices(!1),m=d.length,h=new Int32Array(m),p=r.length,g=Tn(),v=Array(p),y=Array(p);for(let t=0;t<r.length;++t)v[t]=g.add(r[t],[]),y[t]=a[t];const _=function(t,e){const n=["i","a","j","b"];return Mt(n,"{"+$t(t,((t,e)=>`_${e}.push($${e}(${n}));`))+"}",t,e)}(v,y),w=l(n)?_r:yr;if(w(_,n,o,f,i,d,c,h,u,m),s.left)for(let t=0;t<u;++t)c[t]||_(i[t],o,pr,f);if(s.right)for(let t=0;t<m;++t)h[t]||_(pr,o,d[t],f);return g.new(t)}(t,e,o,function(t,e,n,r,a=[]){if(l(n)){let s,o,i,u=n.length;s=o=i={names:[],exprs:[]},u--&&(s=Sn("join",t,n[0],r)),u--&&(o=Sn("join",e,n[1],hr)),u--&&(i=hn(n[2],r));const l=new Set,c=new Set(s.names);return o.names.forEach((t=>{c.has(t)&&l.add(t)})),l.size&&(""!==a[0]&&vr(s.names,l,a[0]||"_1"),""!==a[1]&&vr(o.names,l,a[1]||"_2")),{names:s.names.concat(o.names,i.names),exprs:s.exprs.concat(o.exprs,i.exprs)}}return hn(n,r)}(t,e,r,s,a&&a.suffix),a)}function vr(t,e,n){t.forEach(((r,a)=>e.has(r)?t[a]=r+n:0))}function yr(t,e,n,r,a,s,o,i,u,l){for(let c=0;c<u;++c){const u=a[c];for(let a=0;a<l;++a){const l=s[a];e(u,n,l,r)&&(t(u,n,l,r),o[c]=1,i[a]=1)}}}function _r(t,[e,n],r,a,s,o,i,u,l,c){let f,d,m,h,p,g,v,y,_=t;l>=c?(f=r,d=e,m=i,h=s,p=a,g=n,v=u,y=o):(f=a,d=n,m=u,h=o,p=r,g=e,v=i,y=s,_=(e,n,r,a)=>t(r,a,e,n));const w=function(t,e,n){const r=new Map,a=t.length;for(let s=0;s<a;++s){const a=n(t[s],e);null!=a&&a==a&&(r.has(a)?r.get(a).push(s):r.set(a,[s]))}return r}(y,p,g),x=h.length;for(let t=0;t<x;++t){const e=h[t],n=w.get(d(e,f));if(n){const r=n.length;for(let t=0;t<r;++t){const r=n[t];_(e,f,y[r],p),v[r]=1}m[t]=1}}}function wr(t,e,n,...r){return n=er(t,e,n),r=0===r.length?[En(t.columnNames())]:r.flat(),function(t,e,[n,r],{names:a,exprs:s,ops:o=[]}){const i=Tn(t),l=t.totalRows();a.forEach((t=>i.add(t,Array(l).fill(u))));const c=Xn(e,r),f=Mt(["lr","rr","data"],"{"+$t(a,((t,e)=>`_[${e}][lr] = $[${e}](rr, data);`))+"}",a.map((t=>i.data[t])),Dt(e,o,s)),d=e.data();return t.scan(((t,e)=>{const r=c.get(n(t,e));r>=0&&f(t,r,d)})),i.derive(t)}(t,e,[tr("lookup",t,n[0]),tr("lookup",e,n[1])],Sn("lookup",e,r))}const xr=(t,e,n,r)=>`((u = ${t}) < (v = ${e}) || u == null) && v != null ? ${n} : (u > v || v == null) && u != null ? ${r} : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${n} : v !== v && u === u ? ${r} : `,br=(t,e,n,r,a)=>`(v = ${e}, (u = ${t}) == null && v == null) ? 0 : v == null ? ${r} : u == null ? ${n} : (u = ${a}(u,v)) ? u : `;function $r(t,...e){return function(t,e){return t.create({order:e})}(t,function(t,e){let n=-1;const r=new Map,a=t=>r.set(++n+"",t);return e.forEach((e=>{const n=null!=e.expr?e.expr:e;if(T(n)&&!Tt(n))for(const t in n)a(n[t]);else a(Ae(n)?yn(e,t.columnName(n)):m(n)?yn(e):Tt(n)?e:it("Invalid orderby field: "+(e+"")))})),function(t,e){const n=[],r=[],a=[];let s=null,o="0",i="0";t.isGrouped()&&(s=t.groups().keys,o="ka",i="kb");const{ops:u}=hn(e,{table:t,value:(t,e)=>{if(n.push(t),e.escape){const t=t=>`fn[${a.length}](${t}, data)`;r.push([t("a"),t("b")]),a.push(e.escape)}else r.push([ye(e,{index:"a",op:o}),ye(e,{index:"b",op:i})])},window:!1}),l=Ft(t,u),c=(t,e)=>l[t][e],f=n.length;let d="return (a, b) => {"+(c&&t.isGrouped()?"const ka = keys[a], kb = keys[b];":"")+"let u, v; return ";for(let t=0;t<f;++t){const s=e.get(n[t]),o=s.desc?-1:1,[i,u]=r[t];s.collate?(d+=br(i,u,-o,o,`${o<0?"-":""}fn[${a.length}]`),a.push(s.collate)):d+=xr(i,u,-o,o)}return d+="0;};",Function("op","keys","fn","data",d)(c,s,a,t.data())}(t,r)}(t,e.flat()))}function Mr(t,e,n,r){return function(t,e,n,r={}){const{keys:a,keyColumn:s}=function(t,e,n){const r=n.limit>0?+n.limit:1/0,a=jr(n.sort,!0),s=jr(n.keySeparator,"_"),o=Dt(t,e.ops,e.exprs),i=1===o.length?o[0]:(t,e)=>o.map((n=>n(t,e))).join(s),u=Array(t.totalRows());t.scan(((t,e)=>u[t]=i(t,e)));const l=Ft(cr(t),[{id:0,name:"array_agg_distinct",fields:[t=>u[t]],params:[]}])[0][0],c=a?l.sort():l;return{keys:Number.isFinite(r)?c.slice(0,r):c,keyColumn:u}}(t,e,r),o=jr(r.valueSeparator,"_"),i=n.names.length>1?(t,e)=>e+o+a[t]:t=>a[t],u=a.map((e=>Ft(t,n.ops.map((t=>{if("count"===t.name){const n=t=>e===s[t]?1:NaN;return n.toString=()=>e+":1",{...t,name:"sum",fields:[n]}}const n=t.fields.map((t=>{const n=(n,r)=>e===s[n]?t(n,r):NaN;return n.toString=()=>e+":"+t,n}));return{...t,fields:n}})))));return function({names:t,exprs:e},n,r,a){const s=r?r.size:1,o=Tn(),i=a.length,u=t.length;let l;const c=(t,e)=>l[t][e];r&&qt(o,r);for(let r=0;r<u;++r){const u=e[r];if(null!=u.field)for(let e=0;e<i;++e)o.add(n(e,t[r]),a[e][u.field]);else if(s>1)for(let e=0;e<i;++e){l=a[e];const i=o.add(n(e,t[r]),Array(s));for(let t=0;t<s;++t)i[t]=u(t,null,c)}else for(let e=0;e<i;++e)l=a[e],o.add(n(e,t[r]),[u(0,null,c)])}return o}(n,i,t.groups(),u).new(t)}(t,Sn("fold",t,e),Sn("fold",t,n,{preparse:Er,window:!1,aggronly:!0}),r)}function Er(t){t.forEach(((e,n)=>e.field?t.set(n,X(e+"")):0))}const jr=(t,e)=>null!=t?t:e;function kr(t,e,n,r){return(e?r?Or:Nr:r?Ar:Sr)(t.length,t,n,r)}function Nr(t,e,n){const r=n.length;for(let a=0;a<t;++a)e[a]=n[r*z()|0];return e}function Or(t,e,n,r){const a=n.length,s=new Float64Array(a);let o=0;for(let t=0;t<a;++t)s[t]=o+=r(n[t]);const i=Hn(Et).right;for(let r=0;r<t;++r)e[r]=n[i(s,o*z())];return e}function Sr(t,e,n){const r=n.length;if(t>=r)return n;for(let r=0;r<t;++r)e[r]=n[r];for(let a=t;a<r;++a){const r=a*z();r<t&&(e[0|r]=n[a])}return e}function Ar(t,e,n,r){const a=n.length;if(t>=a)return n;const s=new Float32Array(a),o=new Uint32Array(a);for(let t=0;t<a;++t)o[t]=t,s[t]=-Math.log(z())/r(n[t]);o.sort(((t,e)=>s[t]-s[e]));for(let r=0;r<t;++r)e[r]=n[o[r]];return e}function Cr(t,e,n={}){return function(t,e,n,r={}){const{replace:a,shuffle:s}=r,o=t.partitions(!1);let i=0;e=o.map(((t,n)=>{let r=e(n);return i+=r=a?r:Math.min(t.length,r),r}));const u=new Uint32Array(i);let l=0;o.forEach(((t,r)=>{const s=e[r],o=u.subarray(l,l+=s);a||s!==t.length?kr(o,a,t,n):o.set(t)})),!1!==s&&(o.length>1||!a)&&function(t,e=0,n=t.length){let r=n-(e=+e);for(;r;){const n=z()*r--|0,a=t[r+e];t[r+e]=t[n+e],t[n+e]=a}}(u);return t.reify(u)}(t,function(t,e){return Ae(e)?()=>e:Tr(Fn(t,hn({size:e},{table:t,window:!1})).column("size"))}(t,e),function(t,e){return null==e?null:(e=Ae(e)?t.columnName(e):e,Tr(m(e)?t.column(e):Qn(t,hn({w:e},{table:t}),{drop:!0}).column("w")))}(t,n.weight),n)}const Tr=t=>e=>t.at(e)||0;function Ur(t){return t<0?`count() + ${t}`:t}function Dr(t,e=0,n=1/0){if(t.isGrouped())return Zn(t,function(t=0,e=1/0){return`${Ur(t)} < row_number() && row_number() <= ${Ur(e)}`}(e,n)).reify();const r=[],a=t.numRows();return e=Math.max(0,e+(e<0?a:0)),n=Math.min(a,Math.max(0,n+(n<0?a:0))),t.scan((t=>r.push(t)),!0,n-e,e),t.reify(r)}function Fr(t,e,n){return function(t,{names:e,exprs:n,ops:r=[]},a={}){if(0===e.length)return t;const s=1===e.length&&a.as||[],o=null==a.drop||!!a.drop,i=null==a.limit?s.length||1/0:Math.max(1,+a.limit||1),l=Dt(t,r,n),c=Tn(),f=e.reduce(((t,e,n)=>t.set(e,n)),new Map),d=(e,n)=>{const r=function(t,e,n){const r=t.totalRows(),a=[];return t.scan(((t,s)=>{const o=B(e(t,s)),i=Math.min(o.length,n);for(;a.length<i;)a.push(Array(r).fill(u));for(let e=0;e<i;++e)a[e][t]=o[e]})),a}(t,l[e],i),a=r.length;for(let t=0;t<a;++t)c.add(s[t]||`${n}_${t+1}`,r[t])};return t.columnNames().forEach((e=>{f.has(e)?(o||c.add(e,t.column(e)),d(f.get(e),e),f.delete(e)):c.add(e,t.column(e))})),f.forEach(d),c.derive(t)}(t,Sn("spread",t,e),n)}var Rr=t=>t;function zr(t,e){return Tt(e)?e(t):e||t.columnNames()}function Ir(t,e,n){const r=n.format||{},a=n.align||{},s={},o={};return e.forEach((e=>{const i=function(t,e={}){let n=0,r=0,a=0,s=0,o=0,i=0;return t((t=>{if(++n,null==t)return void++r;const e=typeof t;if("object"===e&&A(t))++a,0===(u=t).getUTCHours()&&0===u.getUTCMinutes()&&0===u.getUTCSeconds()&&0===u.getUTCMilliseconds()&&++s;else if("number"===e&&(++o,t==t&&(0|t)!==t)){const e=t+"",n=e.indexOf(".");if(n>=0){const t=e.indexOf("e"),r=t>0?t:e.length;i=Math.max(i,r-n-1)}}var u})),{align:(r+o+a)/n>.5?"r":"l",format:{utc:a===s,digits:Math.min(i,e.maxdigits||6)}}}(function(t,e){const n=t.column(e);return e=>t.scan((t=>e(n.at(t))))}(t,e),n);o[e]=a[e]||i.align,s[e]=r[e]||i.format})),{align:o,format:s}}function qr(t,e,n=100,r,a){const{start:s=Rr,cell:o,end:i=Rr}=a,u=t.data(),l=e.length;t.scan((t=>{s(t);for(let n=0;n<l;++n){const r=e[n];o(u[r].at(t),r,n)}i(t)}),!0,n,r)}function Pr(t,a={}){const{columns:s,limit:o=1/0,offset:i=0,types:u={},...l}=a,c=zr(t,s),f=t.data(),m=0===i&&t.numRows()<=o&&!t.isFiltered()&&!t.isOrdered();return e(c.map((e=>{const a=f[e],s=u[e],c=d(a);let h;if(m&&(c||Tt(a.toArray)))h=n(c?a:a.toArray(),s,l);else{const e=c?t=>a[t]:t=>a.at(t);h=r((n=>t.scan((t=>n(e(t))),!0,o,i)),s,l)}return[e,h]})))}function Lr(t,e={}){const{format:n="stream",...r}=e;return a(Pr(t,r),{format:n})}function Gr(t,e={}){const n=zr(t,e.columns),r=e.format||{},a=e.delimiter||",",s=e.header??!0,o=new RegExp(`["${a}\n\r]`),i=t=>null==t?"":A(t)?b(t,!0):o.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t,u=n.map(i);let l=s?u.join(a)+"\n":"";return qr(t,n,e.limit||1/0,e.offset,{cell(t,e,n){u[n]=i(r[e]?r[e](t):t)},end(){l+=u.join(a)+"\n"}}),l}function Hr(t,e={}){if(Tt(e))return e(t)+"";const n=typeof t;if("object"===n){if(A(t))return e.utc?b(t):x(t);{const n=JSON.stringify(t,((t,e)=>f(e)?Array.from(e):e)),r=e.maxlen||30;return n.length>r?n.slice(0,28)+"…"+("["===n[0]?"]":"}"):n}}if("number"===n){const n=e.digits||0;let r;return 0!==t&&((r=Math.abs(t))>=1e18||r<Math.pow(10,-n))?t.toExponential(n):t.toFixed(n)}return t+""}function Jr(t,e={}){const n=zr(t,e.columns),{align:r,format:a}=Ir(t,n,e),s=function(t){return function(t,e,n={}){for(const r in t)n[r]=e(t[r],r);return n}(t.style,(t=>Tt(t)?t:()=>t))}(e),o=e.null,i=(t,e)=>Hr(t,e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),u=o?(t,e)=>null==t?o(t):i(t,e):i;let l=-1,c=-1;const f=(t,e,n)=>{const a=n?(t=>"c"===t?"center":"r"===t?"right":"left")(r[e]):"",o=s[t]&&s[t](e,c,l)||"",i=(a?`text-align: ${a};`+(o?" ":""):"")+o;return`<${t}${i?` style="${i}"`:""}>`};let d=f("table")+f("thead")+f("tr",l)+n.map((t=>`${f("th",t,1)}${t}</th>`)).join("")+"</tr></thead>"+f("tbody");return qr(t,n,e.limit,e.offset,{start(t){l=t,++c,d+=f("tr")},cell(t,e){d+=f("td",e,1)+u(t,a[e])+"</td>"},end(){d+="</tr>"}}),d+"</tbody></table>"}function Vr(t,e=!0,n=!1){return void 0===t||t?e:n}const Wr=t=>A(t)?b(t,!0):t;function Br(t,e={}){const n=Vr(e.schema),r=e.format||{},a=zr(t,e.columns);let s="{";return n&&(s+='"schema":{"fields":'+JSON.stringify(a.map((t=>({name:t}))))+'},"data":{'),a.forEach(((n,a)=>{s+=(a?",":"")+JSON.stringify(n)+":[";const o=t.column(n),i=r[n]||Wr;let u=-1;t.scan((t=>{const e=o.at(t);s+=(++u?",":"")+JSON.stringify(i(e))}),!0,e.limit,e.offset),s+="]"})),s+"}"+(n?"}":"")}function Yr(t,e={}){const n=zr(t,e.columns),{align:r,format:a}=Ir(t,n,e),s=t=>t.replace(/\|/g,"\\|");let o="|"+n.map(s).join("|")+"|\n|"+n.map((t=>{return"c"===(e=r[t])?":-:":"r"===e?"-:":":-";var e})).join("|")+"|\n";return qr(t,n,e.limit,e.offset,{start(){o+="|"},cell(t,e){o+=s(Hr(t,a[e]))+"|"},end(){o+="\n"}}),o}class Qr extends qn{assign(...t){return function(t,...e){e=e.flat();const n=t.numRows(),r=t.reify(),a=Tn(r).groupby(r.groups());return e.forEach((t=>{(t=t instanceof qn?t:new qn(t)).numRows()!==n&&it("Assign row counts do not match"),(t=t.reify()).columnNames((e=>a.add(e,t.column(e))))})),a.new(t)}(this,...t)}count(t={}){const{as:e="count"}=t;return Dn(this,{[e]:tt()})}derive(t,e){return function(t,e,n={}){const r=Qn(t,hn(e,{table:t}),n);return n.drop||null==n.before&&null==n.after?r:Gn(r,Object.keys(e).filter((e=>!t.column(e))),n)}(this,t,e)}filter(t){return Zn(this,t)}slice(t,e){return Dr(this,t,e)}groupby(...t){return An(this,...t)}orderby(...t){return $r(this,...t)}relocate(t,e){return Gn(this,B(t),e)}rename(...t){return function(t,...e){const n=new Map;return t.columnNames((t=>(n.set(t,t),0))),zn(t,xn(t,e.flat(),n))}(this,...t)}reduce(t){return function(t,e){const n=Tn(),r=t.groups(),{get:a,names:s=[],rows:o,size:i=1}=r||{},u=new Uint32Array(i+1);s.forEach((t=>n.add(t,null)));const l=r?It(t,e,r):[zt(t,e)];e.outputs().map((t=>n.add(t,[])));const c=u.length-1;let f=0;for(let t=0;t<c;++t)f+=u[t+1]=e.write(l[t],n.data,u[t]);if(r){const e=t.data();s.forEach(((t,r)=>{const s=n.data[t]=Array(f),l=a[r];for(let t=0,n=0;t<i;++t)s.fill(l(o[t],e),n,n+=u[t+1])}))}return n.new(t)}(this,t)}rollup(t){return Dn(this,t)}sample(t,e){return Cr(this,t,e)}select(...t){return Rn(this,...t)}ungroup(){return cr(this)}unorder(){return function(t){return t.isOrdered()?t.create({order:null}):t}(this)}dedupe(...t){return Kn(this,...t)}impute(t,e){return function(t,e,n={}){if((e=hn(e,{table:t})).names.forEach((e=>t.column(e)?0:it(`Invalid impute column ${Q(e)}`))),n.expand){const r={preparse:fr,window:!1,aggronly:!0},a=Sn("impute",t,n.expand,r),s=Fn(cr(t),a);return dr(t,e,a.names,a.names.map((t=>s.get(t,0))))}return dr(t,e)}(this,t,e)}fold(t,e){return lr(this,t,e)}pivot(t,e,n){return Mr(this,t,e,n)}spread(t,e){return Fr(this,t,e)}unroll(t,e){return function(t,e,n){return ur(t,Sn("unroll",t,e),n&&n.drop?{...n,drop:Sn("unroll",t,n.drop).names}:n)}(this,t,e)}lookup(t,e,...n){return wr(this,t,e,...n)}join(t,e,n,r){return gr(this,t,e,n,r)}join_left(t,e,n,r){return gr(this,t,e,n,{...r,left:!0,right:!1})}join_right(t,e,n,r){return gr(this,t,e,n,{...r,left:!1,right:!0})}join_full(t,e,n,r){return gr(this,t,e,n,{...r,left:!0,right:!0})}cross(t,e,n){return function(t,e,n,r){return gr(t,e,(()=>!0),n,{...r,left:!0,right:!0})}(this,t,e,n)}semijoin(t,e){return rr(this,t,e)}antijoin(t,e){return ar(this,t,e)}concat(...t){return Ln(this,...t)}union(...t){return function(t,...e){return Kn(Ln(t,e.flat()))}(this,...t)}intersect(...t){return function(t,...e){e=e.flat();const n=t.columnNames();return e.length?Kn(e.reduce(((t,e)=>rr(t,e.select(n))),t)):t.reify([])}(this,...t)}except(...t){return function(t,...e){if(0===(e=e.flat()).length)return t;const n=t.columnNames();return Kn(e.reduce(((t,e)=>ar(t,e.select(n))),t))}(this,...t)}toArrow(t){return Pr(this,t)}toArrowIPC(t){return Lr(this,t)}toCSV(t){return Gr(this,t)}toHTML(t){return Jr(this,t)}toJSON(t){return Br(this,t)}toMarkdown(t){return Yr(this,t)}}function Zr(t,e){const{columns:n=Mn(),...r}=e||{},a=t instanceof ArrayBuffer||t instanceof Uint8Array?s(t,{useDate:!0,...r}):t,{fields:o}=a.schema,i=o.map((t=>t.name)),u=xn({columnNames:t=>t?i.filter(t):i.slice(),columnIndex:t=>i.indexOf(t)},n),l=Tn();return u.forEach(((t,e)=>{const n=a.getChild(e);l.add(t,-1===n.type.typeId?function(t){const{data:e,length:n,nullCount:r}=t,a=e[e.length-1],s=a.cache??a.dictionary.toArray(),o=s.length,i=function(t,e,n,r){const a=t.length>1||n?function(t,e){const n=t[0].values.constructor,r=new n(e),a=t.length;for(let e,n=0,s=0;n<a;++n)e=t[n].length,r.set(t[n].values.subarray(0,e),s),s+=e;return r}(t,e):t[0].values;return n?function(t,e,n){const r=t.length;for(let a,s=0,o=0;s<r;++s){const r=t[s],{length:i}=r,u=r.validity??r.nullBitmap,l=i>>3;if(u&&u.length)for(let t=0;t<=l;++t)if(255!==(a=u[t])){const r=o+(t<<3);0==(1&a)&&(e[r+0]=n),0==(2&a)&&(e[r+1]=n),0==(4&a)&&(e[r+2]=n),0==(8&a)&&(e[r+3]=n),0==(16&a)&&(e[r+4]=n),0==(32&a)&&(e[r+5]=n),0==(64&a)&&(e[r+6]=n),0==(128&a)&&(e[r+7]=n)}o+=i}return e}(t,a,r):a}(e,n,r,o),u=r?t=>t===o?null:s[t]:t=>s[t];return{length:n,nullCount:r,at:t=>u(i[t]),key:t=>i[t],keyFor(t){if(null===t)return r?o:-1;for(let e=0;e<o;++e)if(s[e]===t)return e;return-1},groups(t){const e=o+(r?1:0);return{keys:i,get:[u],names:t,rows:V(0,e),size:e}},[Symbol.iterator]:()=>t[Symbol.iterator](),toArray:()=>t.toArray()}}(n):n)})),new Qr(l.data,l.names)}const Kr=[t=>"true"===t||"false"===t,t=>"false"!==t],Xr=[t=>"NaN"===t||(t=+t)===t,t=>+t],ta=[M,t=>new Date(Date.parse(t))];function ea(t){const{decimal:e}=t;return e&&"."!==e?Xr.map((t=>n=>t(n&&n.replace(e,".")))):Xr}function na(t,e){const n=t.length;for(let r=0;r<n;++r){const n=t[r];if(null!=n&&!e(n))return!1}return!0}function ra(t,e=0){return Ut(t-e,(t=>`col${t+e+1}`))}function aa(t,e,n){let r=t();const a=r.length,s=+n.autoMax||1e3,o=Ut(a,(()=>[]));e=e?e.length<a?[...e,ra(a,e.length)]:e:ra(a);let i=0;for(;i<s&&r;++i,r=t())for(let t=0;t<a;++t)o[t].push(""===r[t]?null:r[t]);const u=function(t,e,n){const{parse:r={}}=n,a=!1===n.autoType;return t.map(((t,s)=>Tt(r[t])?r[t]:a?Rr:function(t,e){const n=[Kr,ea(e),ta],r=n.length;for(let e=0;e<r;++e){const[r,a]=n[e];if(na(t,r))return a}return Rr}(e[s],n)))}(e,o,n);for(u.forEach(((t,e)=>{if(t===Rr)return;const n=o[e];for(let e=0;e<i;++e)null!=n[e]&&(n[e]=t(n[e]))}));r;r=t())for(let t=0;t<a;++t)o[t].push(r[t]?u[t](r[t]):null);const l={};return e.forEach(((t,e)=>l[t]=o[e])),new Qr(l,e)}const sa={},oa={},ia=34,ua=10,la=13;function ca(t,e,n){let r=+e||0;for(;--r>=0;)t();return n?()=>{let e;for(;!e;){if(!n(e=t()))return e;e=null}}:t}function fa(t,e={}){const n=function(t,{delimiter:e=",",skip:n=0,comment:r}){1!==e.length&&it(`Text "delimiter" should be a single character, found "${e}"`);const a=e.charCodeAt(0);let s,o=t.length,i=0,u=o<=0,l=!1;function c(){if(u)return oa;if(l)return l=!1,sa;const e=i;let n,r;if(t.charCodeAt(e)===ia){for(;i++<o&&t.charCodeAt(i)!==ia||t.charCodeAt(++i)===ia;);return(n=i)>=o?u=!0:(r=t.charCodeAt(i++))===ua?l=!0:r===la&&(l=!0,t.charCodeAt(i)===ua&&++i),t.slice(e+1,n-1).replace(/""/g,'"')}for(;i<o;){if((r=t.charCodeAt(n=i++))===ua)l=!0;else if(r===la)l=!0,t.charCodeAt(i)===ua&&++i;else if(r!==a)continue;return t.slice(e,n)}return u=!0,t.slice(e,o)}return t.charCodeAt(o-1)===ua&&--o,t.charCodeAt(o-1)===la&&--o,ca((function(){if((s=c())!==oa){const t=[];for(;s!==sa&&s!==oa;)t.push(s),s=c();return t}}),n,r&&(t=>(t&&t[0]||"").startsWith(r)))}(t,e);return aa(n,!1!==e.header?n():e.names,e)}function da(t,e={}){const n=function(t,{skip:e=0,comment:n}){let r=t.length,a=0;return t.charCodeAt(r-1)===ua&&--r,t.charCodeAt(r-1)===la&&--r,ca((function(){if(a>=r)return;const e=a;let n,s,o=!1;for(;a<r;)if((s=t.charCodeAt(n=a++))===ua?o=!0:s===la&&(o=!0,t.charCodeAt(a)===ua&&++a),o)return t.slice(e,n);return t.slice(e,r)}),e,n&&(t=>(t||"").startsWith(n)))}(t,e),r=function({positions:t,widths:e}){t||e||it('Fixed width files require a "positions" or "widths" option');let n=0;return t||e.map((t=>[n,n+=t]))}(e);return aa((()=>{const t=n();if(t)return r.map((([e,n])=>t.slice(e,n).trim()))}),e.names,e)}function ma(t){const e=t.length;for(let n=0;n<e;++n){const e=t.charCodeAt(n);if(e<48||e>57)return!1}return!0}function ha(t,e={}){const n=Vr(e.autoType);m(t)&&(t=JSON.parse(t));let r,a=t.data;if(T(a)&&!d(a)?t.schema&&t.schema.fields&&(r=t.schema.fields.map((t=>t.name))):a=t,n||e.parse){const t=e.parse||{};for(const e in a){const r=a[e],s=r.length;if(t[e])for(let n=0;n<s;++n)r[n]=t[e](r[n]);else if(n)for(let t=0;t<s;++t){const e=r[t];m(e)&&M(e)&&!ma(e)&&(r[t]=new Date(e))}}}return new Qr(a,r)}function pa(t,e={}){const n=`d[${JSON.stringify(t)}]`,{maxbins:r,nice:a,minstep:s,step:o,offset:i}=e,u=[r,a,s,o];let l=u.length;for(;l&&null==u[--l];)u.pop();return`d => op.bin(${n}, ...op.bins(${n}${u.length?", "+u.map((t=>t+"")).join(", "):""}), ${i||0})`}function ga(t){return gn(t,{escape:!0,toString(){it("Escaped values can not be serialized.")}})}function va(t,e,n){return gn(t,{collate:Tt(e)?e:new Intl.Collator(e,n).compare})}function ya(t){return gn(t,{desc:!0})}function _a(t){return`() => op.round(${+t} * op.count())`}function wa(...t){return t=t.flat(),e=>{const n=new Map,r=Math.min(t.length,e.numCols());for(let a=0;a<r;++a)n.set(e.columnName(a),t[a]);return n}}function xa(t,e,n){return gn(t,{window:{frame:e||[-1/0,0],peers:!!n}})}function ba(t,e){return Dn(cr(t),{_:e}).get("_")}const $a=(t,e)=>it(`Illegal ${e} name: ${Q(t)}`),Ma=(t,e)=>it(`The ${e} ${Q(t)} is already defined. Use override option?`);function Ea(t,e,n,r){return n[t]===e||function(t,e,n=ot,r="function"){t||$a(t,r),!e.override&&P(n,t)&&Ma(t,r)}(t,r)}function ja(t,e,n,r={}){if(Ea(t,e,n,r))return;const[a=0,s=0]=e.param;n[t]=e,ot[t]=(...e)=>K(t,e.slice(0,a),e.slice(a,a+s))}function ka(t,e,n){ja(t,e,ht,n)}function Na(t,e,n){ja(t,e,vt,n)}function Oa(t,e,n={}){1===arguments.length&&(""===(t=(e=t).name)||"anonymous"===t?it("Anonymous function provided, please include a name argument."):t===Me&&((t,e)=>{it(`The ${e} name ${Q(t)} is reserved and can not be overridden.`)})(Me,"function")),Ea(t,e,W,n)||(W[t]=e,ot[t]=e)}function Sa(t,e){const n=e=>it(`Illegal argument type: ${e||typeof t}`);return t instanceof Map?Aa(t.entries(),e):A(t)?n("Date"):C(t)?n("RegExp"):m(t)?n():l(t)?function(t,e){const n=t.length,r={},a=t=>r[t]=Array(n);if(n){const r=(e=e||Object.keys(t[0])).map(a),s=r.length;for(let a=0;a<n;++a){const n=t[a];for(let t=0;t<s;++t)r[t][a]=n[e[t]]}}else e&&e.forEach(a);return r}(t,e):Tt(t[Symbol.iterator])?function(t,e){const n={},r=t=>n[t]=[];let a,s;for(const n of t){a||(a=(e=e||Object.keys(n)).map(r),s=a.length);for(let t=0;t<s;++t)a[t].push(n[e[t]])}!a&&e&&e.forEach(r);return n}(t,e):T(t)?Aa(Object.entries(t),e):n()}function Aa(t,e=["key","value"]){const n=[],r=[];for(const[e,a]of t)n.push(e),r.push(a);const a={};return e[0]&&(a[e[0]]=n),e[1]&&(a[e[1]]=r),a}function Ca(t,e){if(t instanceof Qr)return t;const n={},r=[];for(const[e,a]of xe(t))n[e]=a,r.push(e);return new Qr(n,e||r)}function Ta(t,e){return new Qr(Sa(t,e),e)}function Ua(t,e={}){const n=e.using||fa;return fetch(t,e.fetch).then((t=>t[e.as||"text"]())).then((t=>n(t,e)))}function Da(t,e){return Ua(t,{...e,as:"arrayBuffer",using:Zr})}function Fa(t,e){return Ua(t,{...e,as:"text",using:fa})}function Ra(t,e){return Ua(t,{...e,as:"text",using:da})}function za(t,e){return Ua(t,{...e,as:"json",using:Ia})}function Ia(t,e){return l(t)?Ta(t):ha(t,e)}export{i as BitSet,Qr as ColumnTable,ut as Reducer,qn as Table,ka as addAggregateFunction,Oa as addFunction,Na as addWindowFunction,ba as agg,Mn as all,pa as bin,va as collate,ya as desc,On as endswith,ga as escape,yn as field,_a as frac,Ta as from,Zr as fromArrow,fa as fromCSV,da as fromFixed,ha as fromJSON,Ua as load,Da as loadArrow,Fa as loadCSV,Ra as loadFixed,za as loadJSON,kn as matches,wa as names,En as not,ot as op,hn as parse,jn as range,xa as rolling,I as seed,Nn as startswith,Ca as table,Pr as toArrow,Lr as toArrowIPC,Gr as toCSV,Jr as toHTML,Br as toJSON,Yr as toMarkdown,Xt as walk_ast};export default null;
